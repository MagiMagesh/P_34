[{"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59686", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59686/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59686/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59686/events", "html_url": "https://github.com/pandas-dev/pandas/pull/59686", "id": 2500915021, "node_id": "PR_kwDOAA0YD856KQwr", "number": 59686, "title": "TST (string dtype): resolve all infer_string TODO/xfails in pandas/tests/arrays", "user": {"login": "jorisvandenbossche", "id": 1020496, "node_id": "MDQ6VXNlcjEwMjA0OTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1020496?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jorisvandenbossche", "html_url": "https://github.com/jorisvandenbossche", "followers_url": "https://api.github.com/users/jorisvandenbossche/followers", "following_url": "https://api.github.com/users/jorisvandenbossche/following{/other_user}", "gists_url": "https://api.github.com/users/jorisvandenbossche/gists{/gist_id}", "starred_url": "https://api.github.com/users/jorisvandenbossche/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jorisvandenbossche/subscriptions", "organizations_url": "https://api.github.com/users/jorisvandenbossche/orgs", "repos_url": "https://api.github.com/users/jorisvandenbossche/repos", "events_url": "https://api.github.com/users/jorisvandenbossche/events{/privacy}", "received_events_url": "https://api.github.com/users/jorisvandenbossche/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 57522093, "node_id": "MDU6TGFiZWw1NzUyMjA5Mw==", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Strings", "name": "Strings", "color": "5319e7", "default": false, "description": "String extension data type and string data"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2024-09-02T12:56:42Z", "updated_at": "2024-09-02T12:56:42Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "draft": true, "pull_request": {"url": "https://api.github.com/repos/pandas-dev/pandas/pulls/59686", "html_url": "https://github.com/pandas-dev/pandas/pull/59686", "diff_url": "https://github.com/pandas-dev/pandas/pull/59686.diff", "patch_url": "https://github.com/pandas-dev/pandas/pull/59686.patch", "merged_at": null}, "body": "Together with the test changes in https://github.com/pandas-dev/pandas/pull/59678 and https://github.com/pandas-dev/pandas/pull/59682, this PR then resolves the remaining `infer_string` TODO or xfails in `pandas/tests/arrays`\r\n\r\nxref https://github.com/pandas-dev/pandas/issues/54792/", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59686/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59686/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59685", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59685/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59685/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59685/events", "html_url": "https://github.com/pandas-dev/pandas/pull/59685", "id": 2500794601, "node_id": "PR_kwDOAA0YD856J19v", "number": 59685, "title": "String dtype: map builtin str alias to StringDtype", "user": {"login": "jorisvandenbossche", "id": 1020496, "node_id": "MDQ6VXNlcjEwMjA0OTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1020496?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jorisvandenbossche", "html_url": "https://github.com/jorisvandenbossche", "followers_url": "https://api.github.com/users/jorisvandenbossche/followers", "following_url": "https://api.github.com/users/jorisvandenbossche/following{/other_user}", "gists_url": "https://api.github.com/users/jorisvandenbossche/gists{/gist_id}", "starred_url": "https://api.github.com/users/jorisvandenbossche/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jorisvandenbossche/subscriptions", "organizations_url": "https://api.github.com/users/jorisvandenbossche/orgs", "repos_url": "https://api.github.com/users/jorisvandenbossche/repos", "events_url": "https://api.github.com/users/jorisvandenbossche/events{/privacy}", "received_events_url": "https://api.github.com/users/jorisvandenbossche/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 57522093, "node_id": "MDU6TGFiZWw1NzUyMjA5Mw==", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Strings", "name": "Strings", "color": "5319e7", "default": false, "description": "String extension data type and string data"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pandas-dev/pandas/milestones/119", "html_url": "https://github.com/pandas-dev/pandas/milestone/119", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/milestones/119/labels", "id": 11466880, "node_id": "MI_kwDOAA0YD84ArviA", "number": 119, "title": "2.3", "description": "", "creator": {"login": "jorisvandenbossche", "id": 1020496, "node_id": "MDQ6VXNlcjEwMjA0OTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1020496?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jorisvandenbossche", "html_url": "https://github.com/jorisvandenbossche", "followers_url": "https://api.github.com/users/jorisvandenbossche/followers", "following_url": "https://api.github.com/users/jorisvandenbossche/following{/other_user}", "gists_url": "https://api.github.com/users/jorisvandenbossche/gists{/gist_id}", "starred_url": "https://api.github.com/users/jorisvandenbossche/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jorisvandenbossche/subscriptions", "organizations_url": "https://api.github.com/users/jorisvandenbossche/orgs", "repos_url": "https://api.github.com/users/jorisvandenbossche/repos", "events_url": "https://api.github.com/users/jorisvandenbossche/events{/privacy}", "received_events_url": "https://api.github.com/users/jorisvandenbossche/received_events", "type": "User", "site_admin": false}, "open_issues": 11, "closed_issues": 39, "state": "open", "created_at": "2024-08-20T19:39:44Z", "updated_at": "2024-09-02T12:03:43Z", "due_on": null, "closed_at": null}, "comments": 0, "created_at": "2024-09-02T12:03:43Z", "updated_at": "2024-09-02T13:55:40Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "draft": true, "pull_request": {"url": "https://api.github.com/repos/pandas-dev/pandas/pulls/59685", "html_url": "https://github.com/pandas-dev/pandas/pull/59685", "diff_url": "https://github.com/pandas-dev/pandas/pull/59685.diff", "patch_url": "https://github.com/pandas-dev/pandas/pull/59685.patch", "merged_at": null}, "body": "This ensures that the builtin type `str` is also mapped to the future default string dtype (if `infer_string` is enabled), i.e. to make `.astype(str)` behave the same as `.astype('str\")`.\r\n\r\nIn general we rely on numpy for mapping builtin types to dtypes. For example `int` is mapped to `np.dtype(\"int64\")` by passing that value to `np.dtype(..)` in `pandas_dtype()`. \r\nBut now that we have a default dtype that is mapped to one of those builtin types, we can no longer rely on numpy doing that. Implementation wise, for `pandas_dtype(str)` I currently added a special case checking explicitly for `str` and then importing the dtype lazily and returning it. \r\n\r\nAn alternative could be to handle this through the ExtensionDtype `Registry.find()`. However, that currently relies on using `ExtensionDtype.construct_from_string()` (i.e. we would have to expand the typing there to allow type objects as well next to strings, which is of course also possible). And maybe it is better to have control centrally about builtin aliases, instead of allowing external dtypes to map to those as well.\r\n\r\nxref https://github.com/pandas-dev/pandas/issues/54792/", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59685/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59685/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59684", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59684/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59684/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59684/events", "html_url": "https://github.com/pandas-dev/pandas/issues/59684", "id": 2500772790, "node_id": "I_kwDOAA0YD86VDsO2", "number": 59684, "title": "BUG: fsspec URL chaining support is not working", "user": {"login": "Nitro963", "id": 48320773, "node_id": "MDQ6VXNlcjQ4MzIwNzcz", "avatar_url": "https://avatars.githubusercontent.com/u/48320773?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nitro963", "html_url": "https://github.com/Nitro963", "followers_url": "https://api.github.com/users/Nitro963/followers", "following_url": "https://api.github.com/users/Nitro963/following{/other_user}", "gists_url": "https://api.github.com/users/Nitro963/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nitro963/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nitro963/subscriptions", "organizations_url": "https://api.github.com/users/Nitro963/orgs", "repos_url": "https://api.github.com/users/Nitro963/repos", "events_url": "https://api.github.com/users/Nitro963/events{/privacy}", "received_events_url": "https://api.github.com/users/Nitro963/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 76811, "node_id": "MDU6TGFiZWw3NjgxMQ==", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Bug", "name": "Bug", "color": "e10c02", "default": false, "description": null}, {"id": 1954720290, "node_id": "MDU6TGFiZWwxOTU0NzIwMjkw", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage", "name": "Needs Triage", "color": "0052cc", "default": false, "description": "Issue that has not been reviewed by a pandas team member"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2024-09-02T11:53:16Z", "updated_at": "2024-09-02T12:02:51Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Pandas version checks\r\n\r\n- [X] I have checked that this issue has not already been reported.\r\n\r\n- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.\r\n\r\n- [ ] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.\r\n\r\n\r\n### Reproducible Example\r\n\r\n```python\r\nimport pandas as pd\r\npath = ('filecache::s3://ncei-wcsd-archive/data/processed/SH1305/18kHz'\r\n        '/SaKe2013-D20130523-T080854_to_SaKe2013-D20130523-T085643.csv')\r\n\r\nstorage_options = {'s3': {'anon': True}, 'filecache': {'cache_storage': 'TMP', 'expiry_time': 259200}}\r\n\r\npd.read_csv(path, storage_options=storage_options) # <-- this produces the error\r\n\r\nwith fsspec.open(path,\r\n                 **storage_options) as f:\r\n    df = pd.read_csv(f) # <-- this will work properly\r\n```\r\n\r\n\r\n### Issue Description\r\n\r\nThe provided code snippet will fail and raise a ValueError. Although that the provided URL is indeed a valid fsspec file path.\r\n\r\n```python-traceback\r\nTraceback (most recent call last):\r\n  File \"/server_code/playground.py\", line 31, in <module>\r\n    pd.read_csv(path, storage_options=storage_options)\r\n  File \"/usr/local/lib/python3.11/dist-packages/pandas/io/parsers/readers.py\", line 948, in read_csv\r\n    return _read(filepath_or_buffer, kwds)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/usr/local/lib/python3.11/dist-packages/pandas/io/parsers/readers.py\", line 611, in _read\r\n    parser = TextFileReader(filepath_or_buffer, **kwds)\r\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/usr/local/lib/python3.11/dist-packages/pandas/io/parsers/readers.py\", line 1448, in __init__\r\n    self._engine = self._make_engine(f, self.engine)\r\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/usr/local/lib/python3.11/dist-packages/pandas/io/parsers/readers.py\", line 1705, in _make_engine\r\n    self.handles = get_handle(\r\n                   ^^^^^^^^^^^\r\n  File \"/usr/local/lib/python3.11/dist-packages/pandas/io/common.py\", line 718, in get_handle\r\n    ioargs = _get_filepath_or_buffer(\r\n             ^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/usr/local/lib/python3.11/dist-packages/pandas/io/common.py\", line 441, in _get_filepath_or_buffer\r\n    raise ValueError(\r\nValueError: storage_options passed with file object or non-fsspec file path\r\n```\r\n\r\n### Expected Behavior\r\n\r\n`pd.read_*` should integrate out of the box with the provided `storage_option` as it contain valid keyword arguments for `fsspec.open`\r\n\r\n### Installed Versions\r\n\r\n<details>\r\n\r\nINSTALLED VERSIONS\r\n------------------\r\ncommit              : a671b5a8bf5dd13fb19f0e88edc679bc9e15c673\r\npython              : 3.11.9.final.0\r\npython-bits         : 64\r\nOS                  : Linux\r\nOS-release          : 5.15.153.1-microsoft-standard-WSL2\r\nVersion             : #1 SMP Fri Mar 29 23:14:13 UTC 2024\r\nmachine             : x86_64\r\nprocessor           : x86_64\r\nbyteorder           : little\r\nLC_ALL              : C.UTF-8\r\nLANG                : C.UTF-8\r\nLOCALE              : en_US.UTF-8\r\n\r\npandas              : 2.1.4\r\nnumpy               : 1.26.4\r\npytz                : 2024.1\r\ndateutil            : 2.9.0.post0\r\nsetuptools          : 72.1.0\r\npip                 : 24.2\r\nCython              : 3.0.11\r\npytest              : 8.2.2\r\nhypothesis          : None\r\nsphinx              : None\r\nblosc               : None\r\nfeather             : None\r\nxlsxwriter          : None\r\nlxml.etree          : None\r\nhtml5lib            : None\r\npymysql             : None\r\npsycopg2            : None\r\njinja2              : 3.1.4\r\nIPython             : 8.25.0\r\npandas_datareader   : None\r\nbs4                 : 4.12.3\r\nbottleneck          : None\r\ndataframe-api-compat: None\r\nfastparquet         : None\r\nfsspec              : 2024.6.1\r\ngcsfs               : None\r\nmatplotlib          : 3.7.5\r\nnumba               : 0.60.0\r\nnumexpr             : None\r\nodfpy               : None\r\nopenpyxl            : None\r\npandas_gbq          : None\r\npyarrow             : 17.0.0\r\npyreadstat          : None\r\npyxlsb              : None\r\ns3fs                : 2024.6.1\r\nscipy               : 1.11.4\r\nsqlalchemy          : 2.0.32\r\ntables              : None\r\ntabulate            : 0.9.0\r\nxarray              : None\r\nxlrd                : None\r\nzstandard           : None\r\ntzdata              : 2024.1\r\nqtpy                : None\r\npyqt5               : None\r\n\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59684/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59684/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59683", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59683/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59683/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59683/events", "html_url": "https://github.com/pandas-dev/pandas/pull/59683", "id": 2500456650, "node_id": "PR_kwDOAA0YD856Isgh", "number": 59683, "title": "fix: use fastpath for PyCapsule export when starting from pyarrow-backed Series, respect requested_schema", "user": {"login": "MarcoGorelli", "id": 33491632, "node_id": "MDQ6VXNlcjMzNDkxNjMy", "avatar_url": "https://avatars.githubusercontent.com/u/33491632?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MarcoGorelli", "html_url": "https://github.com/MarcoGorelli", "followers_url": "https://api.github.com/users/MarcoGorelli/followers", "following_url": "https://api.github.com/users/MarcoGorelli/following{/other_user}", "gists_url": "https://api.github.com/users/MarcoGorelli/gists{/gist_id}", "starred_url": "https://api.github.com/users/MarcoGorelli/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MarcoGorelli/subscriptions", "organizations_url": "https://api.github.com/users/MarcoGorelli/orgs", "repos_url": "https://api.github.com/users/MarcoGorelli/repos", "events_url": "https://api.github.com/users/MarcoGorelli/events{/privacy}", "received_events_url": "https://api.github.com/users/MarcoGorelli/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2024-09-02T09:23:41Z", "updated_at": "2024-09-02T09:29:35Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "draft": true, "pull_request": {"url": "https://api.github.com/repos/pandas-dev/pandas/pulls/59683", "html_url": "https://github.com/pandas-dev/pandas/pull/59683", "diff_url": "https://github.com/pandas-dev/pandas/pull/59683.diff", "patch_url": "https://github.com/pandas-dev/pandas/pull/59683.patch", "merged_at": null}, "body": "Follow-up to https://github.com/pandas-dev/pandas/pull/59587/files (so, I haven't added a new whatsnew)\r\n\r\n- [ ] closes #xxxx (Replace xxxx with the GitHub issue number)\r\n- [ ] [Tests added and passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#writing-tests) if fixing a bug or adding a new feature\r\n- [ ] All [code checks passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#pre-commit).\r\n- [ ] Added [type annotations](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#type-hints) to new arguments/methods/functions.\r\n- [ ] Added an entry in the latest `doc/source/whatsnew/vX.X.X.rst` file if fixing a bug or adding a new feature.\r\n", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59683/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59683/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59682", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59682/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59682/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59682/events", "html_url": "https://github.com/pandas-dev/pandas/pull/59682", "id": 2500232395, "node_id": "PR_kwDOAA0YD856H7qy", "number": 59682, "title": "String dtype: implement _get_common_dtype", "user": {"login": "jorisvandenbossche", "id": 1020496, "node_id": "MDQ6VXNlcjEwMjA0OTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1020496?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jorisvandenbossche", "html_url": "https://github.com/jorisvandenbossche", "followers_url": "https://api.github.com/users/jorisvandenbossche/followers", "following_url": "https://api.github.com/users/jorisvandenbossche/following{/other_user}", "gists_url": "https://api.github.com/users/jorisvandenbossche/gists{/gist_id}", "starred_url": "https://api.github.com/users/jorisvandenbossche/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jorisvandenbossche/subscriptions", "organizations_url": "https://api.github.com/users/jorisvandenbossche/orgs", "repos_url": "https://api.github.com/users/jorisvandenbossche/repos", "events_url": "https://api.github.com/users/jorisvandenbossche/events{/privacy}", "received_events_url": "https://api.github.com/users/jorisvandenbossche/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 57522093, "node_id": "MDU6TGFiZWw1NzUyMjA5Mw==", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Strings", "name": "Strings", "color": "5319e7", "default": false, "description": "String extension data type and string data"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pandas-dev/pandas/milestones/119", "html_url": "https://github.com/pandas-dev/pandas/milestone/119", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/milestones/119/labels", "id": 11466880, "node_id": "MI_kwDOAA0YD84ArviA", "number": 119, "title": "2.3", "description": "", "creator": {"login": "jorisvandenbossche", "id": 1020496, "node_id": "MDQ6VXNlcjEwMjA0OTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1020496?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jorisvandenbossche", "html_url": "https://github.com/jorisvandenbossche", "followers_url": "https://api.github.com/users/jorisvandenbossche/followers", "following_url": "https://api.github.com/users/jorisvandenbossche/following{/other_user}", "gists_url": "https://api.github.com/users/jorisvandenbossche/gists{/gist_id}", "starred_url": "https://api.github.com/users/jorisvandenbossche/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jorisvandenbossche/subscriptions", "organizations_url": "https://api.github.com/users/jorisvandenbossche/orgs", "repos_url": "https://api.github.com/users/jorisvandenbossche/repos", "events_url": "https://api.github.com/users/jorisvandenbossche/events{/privacy}", "received_events_url": "https://api.github.com/users/jorisvandenbossche/received_events", "type": "User", "site_admin": false}, "open_issues": 11, "closed_issues": 39, "state": "open", "created_at": "2024-08-20T19:39:44Z", "updated_at": "2024-09-02T12:03:43Z", "due_on": null, "closed_at": null}, "comments": 0, "created_at": "2024-09-02T07:37:31Z", "updated_at": "2024-09-02T12:08:33Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/pandas-dev/pandas/pulls/59682", "html_url": "https://github.com/pandas-dev/pandas/pull/59682", "diff_url": "https://github.com/pandas-dev/pandas/pull/59682.diff", "patch_url": "https://github.com/pandas-dev/pandas/pull/59682.patch", "merged_at": null}, "body": "This PR implements `StringDtype._get_common_dtype` to control the behaviour in concat etc.\r\n\r\nThis fixes two things:\r\n- When concatting with a numpy string-like dtype (S/U), we can preserve our StringDtype instead of converting to object dtype (as happens now). In general we don't store such numpy dtypes in pandas objects, but in certain corner cases we are passing numpy dtypes directly to `find_common_type`.\r\n- When concatting different instances of StringDtype. In practice this shouldn't happen often, but can certainly occur. In this case, I decided to give precedence to the pyarrow / pd.NA: 1) if pyarrow is installed, that's the default and therefore logical pick in this case as well, and 2) pd.NA is opt in, so if you have a mix, assume the user explicitly opted in and propagate that preference.\r\n\r\nxref https://github.com/pandas-dev/pandas/issues/54792\r\n\r\n\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59682/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59682/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59680", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59680/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59680/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59680/events", "html_url": "https://github.com/pandas-dev/pandas/pull/59680", "id": 2499254440, "node_id": "PR_kwDOAA0YD856EtIx", "number": 59680, "title": "Fix groupby agg preserve subclass type", "user": {"login": "AshmitGupta", "id": 67188586, "node_id": "MDQ6VXNlcjY3MTg4NTg2", "avatar_url": "https://avatars.githubusercontent.com/u/67188586?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AshmitGupta", "html_url": "https://github.com/AshmitGupta", "followers_url": "https://api.github.com/users/AshmitGupta/followers", "following_url": "https://api.github.com/users/AshmitGupta/following{/other_user}", "gists_url": "https://api.github.com/users/AshmitGupta/gists{/gist_id}", "starred_url": "https://api.github.com/users/AshmitGupta/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AshmitGupta/subscriptions", "organizations_url": "https://api.github.com/users/AshmitGupta/orgs", "repos_url": "https://api.github.com/users/AshmitGupta/repos", "events_url": "https://api.github.com/users/AshmitGupta/events{/privacy}", "received_events_url": "https://api.github.com/users/AshmitGupta/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2024-09-01T06:21:17Z", "updated_at": "2024-09-02T12:44:38Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/pandas-dev/pandas/pulls/59680", "html_url": "https://github.com/pandas-dev/pandas/pull/59680", "diff_url": "https://github.com/pandas-dev/pandas/pull/59680.diff", "patch_url": "https://github.com/pandas-dev/pandas/pull/59680.patch", "merged_at": null}, "body": "- [x] closes #59667 (Replace xxxx with the GitHub issue number)\r\n- [x] [Tests added and passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#writing-tests) if fixing a bug or adding a new feature\r\n- [x] All [code checks passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#pre-commit).\r\n- [x] Added [type annotations](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#type-hints) to new arguments/methods/functions.\r\n- [x] Added an entry in the latest `doc/source/whatsnew/v2.3.0.rst` file if fixing a bug or adding a new feature.\r\n", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59680/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59680/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59678", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59678/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59678/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59678/events", "html_url": "https://github.com/pandas-dev/pandas/pull/59678", "id": 2498823921, "node_id": "PR_kwDOAA0YD856DUeg", "number": 59678, "title": "TST (string dtype): fix and clean up arrow roundtrip tests", "user": {"login": "jorisvandenbossche", "id": 1020496, "node_id": "MDQ6VXNlcjEwMjA0OTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1020496?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jorisvandenbossche", "html_url": "https://github.com/jorisvandenbossche", "followers_url": "https://api.github.com/users/jorisvandenbossche/followers", "following_url": "https://api.github.com/users/jorisvandenbossche/following{/other_user}", "gists_url": "https://api.github.com/users/jorisvandenbossche/gists{/gist_id}", "starred_url": "https://api.github.com/users/jorisvandenbossche/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jorisvandenbossche/subscriptions", "organizations_url": "https://api.github.com/users/jorisvandenbossche/orgs", "repos_url": "https://api.github.com/users/jorisvandenbossche/repos", "events_url": "https://api.github.com/users/jorisvandenbossche/events{/privacy}", "received_events_url": "https://api.github.com/users/jorisvandenbossche/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 57522093, "node_id": "MDU6TGFiZWw1NzUyMjA5Mw==", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Strings", "name": "Strings", "color": "5319e7", "default": false, "description": "String extension data type and string data"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2024-08-31T12:31:37Z", "updated_at": "2024-09-02T06:59:32Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/pandas-dev/pandas/pulls/59678", "html_url": "https://github.com/pandas-dev/pandas/pull/59678", "diff_url": "https://github.com/pandas-dev/pandas/pull/59678.diff", "patch_url": "https://github.com/pandas-dev/pandas/pull/59678.patch", "merged_at": null}, "body": "xref https://github.com/pandas-dev/pandas/issues/54792\r\n\r\nThe `arrow_compat` tests were already passing (after my previous PR fixing arrow import/export, I assume). \r\nThe `arrow_roundtrip` tests needed a fix in the expected dtypes. ", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59678/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59678/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59671", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59671/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59671/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59671/events", "html_url": "https://github.com/pandas-dev/pandas/issues/59671", "id": 2498100264, "node_id": "I_kwDOAA0YD86U5fwo", "number": 59671, "title": "DOC: Clarify existence Series.dt.to_timestamp", "user": {"login": "sfc-gh-joshi", "id": 149419494, "node_id": "U_kgDOCOf15g", "avatar_url": "https://avatars.githubusercontent.com/u/149419494?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sfc-gh-joshi", "html_url": "https://github.com/sfc-gh-joshi", "followers_url": "https://api.github.com/users/sfc-gh-joshi/followers", "following_url": "https://api.github.com/users/sfc-gh-joshi/following{/other_user}", "gists_url": "https://api.github.com/users/sfc-gh-joshi/gists{/gist_id}", "starred_url": "https://api.github.com/users/sfc-gh-joshi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sfc-gh-joshi/subscriptions", "organizations_url": "https://api.github.com/users/sfc-gh-joshi/orgs", "repos_url": "https://api.github.com/users/sfc-gh-joshi/repos", "events_url": "https://api.github.com/users/sfc-gh-joshi/events{/privacy}", "received_events_url": "https://api.github.com/users/sfc-gh-joshi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 134699, "node_id": "MDU6TGFiZWwxMzQ2OTk=", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Docs", "name": "Docs", "color": "3465A4", "default": false, "description": null}, {"id": 1954720290, "node_id": "MDU6TGFiZWwxOTU0NzIwMjkw", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage", "name": "Needs Triage", "color": "0052cc", "default": false, "description": "Issue that has not been reviewed by a pandas team member"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2024-08-30T20:10:23Z", "updated_at": "2024-08-30T20:10:23Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Pandas version checks\n\n- [X] I have checked that the issue still exists on the latest versions of the docs on `main` [here](https://pandas.pydata.org/docs/dev/)\n\n\n### Location of the documentation\n\nhttps://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.dt.to_timestamp.html (does not exist)\n\n### Documentation problem\n\nCopied from a Modin issue: https://github.com/modin-project/modin/issues/7232#issuecomment-2088100973\r\n\r\n> Series.dt.to_timestamp() is a valid method for PeriodProperties, but not for DatetimeProperties, TimedeltaProperties. For example, following is valid:\r\n\r\n```\r\n>>> seconds_series = pd.Series(pd.period_range(start=\"2000-01-01 00:00:00\", end=\"2000-01-01 00:00:03\", freq=\"s\"))\r\n>>> seconds_series\r\n0    2000-01-01 00:00:00\r\n1    2000-01-01 00:00:01\r\n2    2000-01-01 00:00:02\r\n3    2000-01-01 00:00:03\r\ndtype: period[s]\r\n>>> seconds_series.dt.to_timestamp()\r\n0   2000-01-01 00:00:00\r\n1   2000-01-01 00:00:01\r\n2   2000-01-01 00:00:02\r\n3   2000-01-01 00:00:03\r\ndtype: datetime64[ns]\r\n```\r\n\r\n> However, it is invalid for timedelta:\r\n\r\n```\r\n>>> seconds_series = pd.Series(pd.timedelta_range(start=\"1 second\", periods=3, freq=\"s\"))\r\n>>> seconds_series.dt.to_timestamp()\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\nAttributeError: 'TimedeltaProperties' object has no attribute 'to_timestamp'\r\n>>> seconds_series\r\n0   0 days 00:00:01\r\n1   0 days 00:00:02\r\n2   0 days 00:00:03\r\ndtype: timedelta64[ns]\r\n```\n\n### Suggested fix for documentation\n\nClarify whether `to_timestamp` should exist for all `Series.dt` accessors, and whether it should be implemented for classes other than `PeriodProperties`.", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59671/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59671/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59670", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59670/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59670/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59670/events", "html_url": "https://github.com/pandas-dev/pandas/issues/59670", "id": 2498053335, "node_id": "I_kwDOAA0YD86U5UTX", "number": 59670, "title": "DOC: Document that DataFrame.from_records()'s columns argument also acts as \"include\"", "user": {"login": "cjerdonek", "id": 355822, "node_id": "MDQ6VXNlcjM1NTgyMg==", "avatar_url": "https://avatars.githubusercontent.com/u/355822?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjerdonek", "html_url": "https://github.com/cjerdonek", "followers_url": "https://api.github.com/users/cjerdonek/followers", "following_url": "https://api.github.com/users/cjerdonek/following{/other_user}", "gists_url": "https://api.github.com/users/cjerdonek/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjerdonek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjerdonek/subscriptions", "organizations_url": "https://api.github.com/users/cjerdonek/orgs", "repos_url": "https://api.github.com/users/cjerdonek/repos", "events_url": "https://api.github.com/users/cjerdonek/events{/privacy}", "received_events_url": "https://api.github.com/users/cjerdonek/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 134699, "node_id": "MDU6TGFiZWwxMzQ2OTk=", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Docs", "name": "Docs", "color": "3465A4", "default": false, "description": null}, {"id": 1954720290, "node_id": "MDU6TGFiZWwxOTU0NzIwMjkw", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage", "name": "Needs Triage", "color": "0052cc", "default": false, "description": "Issue that has not been reviewed by a pandas team member"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2024-08-30T19:34:56Z", "updated_at": "2024-08-30T19:37:02Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Pandas version checks\r\n\r\n- [X] I have checked that the issue still exists on the latest versions of the docs on `main` [here](https://pandas.pydata.org/docs/dev/)\r\n\r\n\r\n### Location of the documentation\r\n\r\nhttps://pandas.pydata.org/docs/reference/api/pandas.DataFrame.from_records.html\r\n\r\n### Documentation problem\r\n\r\nCurrently, it's not clear from the `DataFrame.from_records()` docs that the `columns` argument to `from_records()` also has the effect of what an `include` argument (or `usecols`) would do. Indeed, the current wording once led someone to file a feature request asking for an `include` argument to be added: https://github.com/pandas-dev/pandas/issues/15319\r\nHowever, the request was later closed when the maintainers realized the `columns` argument already does this (but it's not documented, hence this issue).\r\n\r\n### Suggested fix for documentation\r\n\r\nAdd a sentence or phrase to the documentation of the `columns` argument that the  argument also has the effect of limiting the DataFrame to including only the columns specified. This isn't implied by the current wording, or it's at least a little ambiguous.", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59670/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59670/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59667", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59667/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59667/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59667/events", "html_url": "https://github.com/pandas-dev/pandas/issues/59667", "id": 2497714925, "node_id": "I_kwDOAA0YD86U4Brt", "number": 59667, "title": "BUG: `df.groupby().aggregate()` doesn't preserve subclass type", "user": {"login": "jaredight", "id": 43591363, "node_id": "MDQ6VXNlcjQzNTkxMzYz", "avatar_url": "https://avatars.githubusercontent.com/u/43591363?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jaredight", "html_url": "https://github.com/jaredight", "followers_url": "https://api.github.com/users/jaredight/followers", "following_url": "https://api.github.com/users/jaredight/following{/other_user}", "gists_url": "https://api.github.com/users/jaredight/gists{/gist_id}", "starred_url": "https://api.github.com/users/jaredight/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jaredight/subscriptions", "organizations_url": "https://api.github.com/users/jaredight/orgs", "repos_url": "https://api.github.com/users/jaredight/repos", "events_url": "https://api.github.com/users/jaredight/events{/privacy}", "received_events_url": "https://api.github.com/users/jaredight/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 76811, "node_id": "MDU6TGFiZWw3NjgxMQ==", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Bug", "name": "Bug", "color": "e10c02", "default": false, "description": null}, {"id": 233160, "node_id": "MDU6TGFiZWwyMzMxNjA=", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Groupby", "name": "Groupby", "color": "729FCF", "default": false, "description": null}, {"id": 697792067, "node_id": "MDU6TGFiZWw2OTc3OTIwNjc=", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Apply", "name": "Apply", "color": "fbca04", "default": false, "description": "Apply, Aggregate, Transform"}, {"id": 2365504893, "node_id": "MDU6TGFiZWwyMzY1NTA0ODkz", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Closing%20Candidate", "name": "Closing Candidate", "color": "be21f2", "default": false, "description": "May be closeable, needs more eyeballs"}, {"id": 2559562239, "node_id": "MDU6TGFiZWwyNTU5NTYyMjM5", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Subclassing", "name": "Subclassing", "color": "abf98b", "default": false, "description": "Subclassing pandas objects"}], "state": "open", "locked": false, "assignee": {"login": "AshmitGupta", "id": 67188586, "node_id": "MDQ6VXNlcjY3MTg4NTg2", "avatar_url": "https://avatars.githubusercontent.com/u/67188586?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AshmitGupta", "html_url": "https://github.com/AshmitGupta", "followers_url": "https://api.github.com/users/AshmitGupta/followers", "following_url": "https://api.github.com/users/AshmitGupta/following{/other_user}", "gists_url": "https://api.github.com/users/AshmitGupta/gists{/gist_id}", "starred_url": "https://api.github.com/users/AshmitGupta/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AshmitGupta/subscriptions", "organizations_url": "https://api.github.com/users/AshmitGupta/orgs", "repos_url": "https://api.github.com/users/AshmitGupta/repos", "events_url": "https://api.github.com/users/AshmitGupta/events{/privacy}", "received_events_url": "https://api.github.com/users/AshmitGupta/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "AshmitGupta", "id": 67188586, "node_id": "MDQ6VXNlcjY3MTg4NTg2", "avatar_url": "https://avatars.githubusercontent.com/u/67188586?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AshmitGupta", "html_url": "https://github.com/AshmitGupta", "followers_url": "https://api.github.com/users/AshmitGupta/followers", "following_url": "https://api.github.com/users/AshmitGupta/following{/other_user}", "gists_url": "https://api.github.com/users/AshmitGupta/gists{/gist_id}", "starred_url": "https://api.github.com/users/AshmitGupta/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AshmitGupta/subscriptions", "organizations_url": "https://api.github.com/users/AshmitGupta/orgs", "repos_url": "https://api.github.com/users/AshmitGupta/repos", "events_url": "https://api.github.com/users/AshmitGupta/events{/privacy}", "received_events_url": "https://api.github.com/users/AshmitGupta/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2024-08-30T16:26:33Z", "updated_at": "2024-09-02T12:43:52Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Pandas version checks\r\n\r\n- [X] I have checked that this issue has not already been reported.\r\n\r\n- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.\r\n\r\n- [X] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.\r\n\r\n\r\n### Reproducible Example\r\n\r\n```python\r\npandas as pd\r\n\r\nclass MySeries(pd.Series):\r\n    pass\r\n\r\nclass MyDataFrame(pd.DataFrame):\r\n    @property\r\n    def _constructor(self):\r\n        return MyDataFrame\r\n    _constructor_sliced = MySeries\r\n\r\nMySeries._constructor_expanddim = MyDataFrame\r\n\r\ndf = MyDataFrame({\"a\": reversed(range(10)), \"b\": list('aaaabbbccc')})\r\n\r\nassert isinstance(df.groupby(\"b\").agg({\"a\": \"sum\"}), MyDataFrame)\r\n```\r\n\r\n### Traceback\r\n\r\n<details>\r\n\r\n```---------------------------------------------------------------------------\r\nAssertionError                            Traceback (most recent call last)\r\n<ipython-input-7-e355635bac0a> in <cell line: 14>()\r\n     12 df = MyDataFrame({\"a\": reversed(range(10)), \"b\": list('aaaabbbccc')})\r\n     13 \r\n---> 14 assert isinstance(df.groupby(\"b\").agg({\"a\": \"sum\"}), MyDataFrame)\r\n\r\nAssertionError: \r\n```\r\n\r\n</details>\r\n\r\n\r\n### Issue Description\r\n\r\nThe `df.groupby().agg()` operation does not preserve subclass type. See [this StackOverflow question](https://stackoverflow.com/questions/78889486/preserving-dataframe-subclass-type-during-pandas-groupby-aggregate) for more details. \r\n\r\nOther relevant issues:\r\n- [groupby and resample methods do not preserve subclassed data structures #28330](https://github.com/pandas-dev/pandas/issues/28330)\r\n- [BUG: DataFrameSubClass.groupby() doesn't use methods of subclass #51757](https://github.com/pandas-dev/pandas/issues/51757)\r\n\r\n### Expected Behavior\r\n\r\nExpected behavior is that `df.groupby().agg()` would be the same class type as `df`.\r\n\r\n### Installed Versions\r\n\r\n<details>\r\n\r\nINSTALLED VERSIONS\r\n------------------\r\ncommit                : d9cdd2ee5a58015ef6f4d15c7226110c9aab8140\r\npython                : 3.10.12.final.0\r\npython-bits           : 64\r\nOS                    : Linux\r\nOS-release            : 6.1.85+\r\nVersion               : #1 SMP PREEMPT_DYNAMIC Thu Jun 27 21:05:47 UTC 2024\r\nmachine               : x86_64\r\nprocessor             : x86_64\r\nbyteorder             : little\r\nLC_ALL                : en_US.UTF-8\r\nLANG                  : en_US.UTF-8\r\nLOCALE                : en_US.UTF-8\r\n\r\npandas                : 2.2.2\r\nnumpy                 : 1.26.4\r\npytz                  : 2024.1\r\ndateutil              : 2.8.2\r\nsetuptools            : 71.0.4\r\npip                   : 24.1.2\r\nCython                : 3.0.11\r\npytest                : 7.4.4\r\nhypothesis            : None\r\nsphinx                : 5.0.2\r\nblosc                 : None\r\nfeather               : None\r\nxlsxwriter            : None\r\nlxml.etree            : 4.9.4\r\nhtml5lib              : 1.1\r\npymysql               : None\r\npsycopg2              : 2.9.9\r\njinja2                : 3.1.4\r\nIPython               : 7.34.0\r\npandas_datareader     : 0.10.0\r\nadbc-driver-postgresql: None\r\nadbc-driver-sqlite    : None\r\nbs4                   : 4.12.3\r\nbottleneck            : None\r\ndataframe-api-compat  : None\r\nfastparquet           : None\r\nfsspec                : 2024.6.1\r\ngcsfs                 : 2024.6.1\r\nmatplotlib            : 3.7.1\r\nnumba                 : 0.60.0\r\nnumexpr               : 2.10.1\r\nodfpy                 : None\r\nopenpyxl              : 3.1.5\r\npandas_gbq            : 0.23.1\r\npyarrow               : 14.0.2\r\npyreadstat            : None\r\npython-calamine       : None\r\npyxlsb                : None\r\ns3fs                  : None\r\nscipy                 : 1.13.1\r\nsqlalchemy            : 2.0.32\r\ntables                : 3.8.0\r\ntabulate              : 0.9.0\r\nxarray                : 2024.6.0\r\nxlrd                  : 2.0.1\r\nzstandard             : None\r\ntzdata                : 2024.1\r\nqtpy                  : None\r\npyqt5                 : None\r\n\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59667/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59667/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59666", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59666/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59666/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59666/events", "html_url": "https://github.com/pandas-dev/pandas/issues/59666", "id": 2497329948, "node_id": "I_kwDOAA0YD86U2jsc", "number": 59666, "title": "BUG: rolling with method='table' and apply sorts columns alphabetically", "user": {"login": "valeju", "id": 143808914, "node_id": "U_kgDOCJJZkg", "avatar_url": "https://avatars.githubusercontent.com/u/143808914?v=4", "gravatar_id": "", "url": "https://api.github.com/users/valeju", "html_url": "https://github.com/valeju", "followers_url": "https://api.github.com/users/valeju/followers", "following_url": "https://api.github.com/users/valeju/following{/other_user}", "gists_url": "https://api.github.com/users/valeju/gists{/gist_id}", "starred_url": "https://api.github.com/users/valeju/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/valeju/subscriptions", "organizations_url": "https://api.github.com/users/valeju/orgs", "repos_url": "https://api.github.com/users/valeju/repos", "events_url": "https://api.github.com/users/valeju/events{/privacy}", "received_events_url": "https://api.github.com/users/valeju/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 76811, "node_id": "MDU6TGFiZWw3NjgxMQ==", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Bug", "name": "Bug", "color": "e10c02", "default": false, "description": null}, {"id": 1954720290, "node_id": "MDU6TGFiZWwxOTU0NzIwMjkw", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage", "name": "Needs Triage", "color": "0052cc", "default": false, "description": "Issue that has not been reviewed by a pandas team member"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2024-08-30T14:01:48Z", "updated_at": "2024-08-30T14:02:22Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Pandas version checks\n\n- [X] I have checked that this issue has not already been reported.\n\n- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.\n\n- [X] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.\n\n\n### Reproducible Example\n\n```python\nimport pandas as pd\r\nimport numpy as np\r\n\r\ndatetime_column = \"datetime\"\r\n\r\ndef sum_of_subtraction(values):\r\n    col_1 = values[:, 0]\r\n    col_2 = values[:, 1]\r\n    return np.mean(col_1 - col_2)\r\n\r\n\r\ncols_order_1 = [\"a\", \"b\"]\r\ncols_order_2 = [\"b\", \"a\"]\r\n\r\ndf = pd.DataFrame(\r\n    {\r\n        datetime_column: pd.date_range(\"2020-01-01\", periods=6),\r\n        \"a\": [1, 2, 3, 4, 5, 6],\r\n        \"b\": [6, 7, 8, 5, 6, 7],\r\n    }\r\n)\r\norder_1_df = (\r\n    df\r\n    .rolling('3D', on=datetime_column, method='table')[cols_order_1]\r\n    .apply(sum_of_subtraction, engine=\"numba\", raw=True)\r\n)\r\n\r\norder_2_df = (\r\n    df\r\n    .rolling('3D', on=datetime_column, method='table')[cols_order_2]\r\n    .apply(sum_of_subtraction, engine=\"numba\", raw=True)\r\n)\n```\n\n\n### Issue Description\n\nWith the code above, the function `sum_of_subtraction` returns a different results if the columns of the input argument `values` are swapped (cf the example below).\r\n\r\n```python\r\nx = np.array([[1, 2],[3, 4]])\r\ny = x[:, [1, 0]]  # columns are swapped\r\nprint(sum_of_subtraction(x))  # returns -1.0\r\nprint(sum_of_subtraction(y))  # returns 1.0\r\n```\r\n\r\nYet, using `rolling` with `method='table'` followed with `apply` returns same results, no matter or the columns ordering. Even though the columns were given with a specific ordering, when calling `apply` with `engine='numba'`, the columns are sorted alphabetically. With the code above, here are the results:\r\n\r\n`order_1_df`: \r\n|    |        a |        b | datetime            |\r\n|---:|---------:|---------:|:--------------------|\r\n|  0 | -5       | -5       | 2020-01-01 00:00:00 |\r\n|  1 | -5       | -5       | 2020-01-02 00:00:00 |\r\n|  2 | -5       | -5       | 2020-01-03 00:00:00 |\r\n|  3 | -3.66667 | -3.66667 | 2020-01-04 00:00:00 |\r\n|  4 | -2.33333 | -2.33333 | 2020-01-05 00:00:00 |\r\n|  5 | -1       | -1       | 2020-01-06 00:00:00 |\r\n\r\n`order_2_df`:\r\n|    |        a |        b | datetime            |\r\n|---:|---------:|---------:|:--------------------|\r\n|  0 | -5       | -5       | 2020-01-01 00:00:00 |\r\n|  1 | -5       | -5       | 2020-01-02 00:00:00 |\r\n|  2 | -5       | -5       | 2020-01-03 00:00:00 |\r\n|  3 | -3.66667 | -3.66667 | 2020-01-04 00:00:00 |\r\n|  4 | -2.33333 | -2.33333 | 2020-01-05 00:00:00 |\r\n|  5 | -1       | -1       | 2020-01-06 00:00:00 |\n\n### Expected Behavior\n\nThe results when the columns are ordering as such `[\"b\", \"a\"]` must be like that (`order_2_df` dataframe):\r\n\r\n|    |       b |       a | datetime            |\r\n|---:|--------:|--------:|:--------------------|\r\n|  0 | 5       | 5       | 2020-01-01 00:00:00 |\r\n|  1 | 5       | 5       | 2020-01-02 00:00:00 |\r\n|  2 | 5       | 5       | 2020-01-03 00:00:00 |\r\n|  3 | 3.66667 | 3.66667 | 2020-01-04 00:00:00 |\r\n|  4 | 2.33333 | 2.33333 | 2020-01-05 00:00:00 |\r\n|  5 | 1       | 1       | 2020-01-06 00:00:00 |\n\n### Installed Versions\n\n<details>\r\n\r\nINSTALLED VERSIONS\r\n------------------\r\ncommit                : e4956ab403846387a435cd7b3a8f36828c23c0c7\r\npython                : 3.10.14\r\npython-bits           : 64\r\nOS                    : Linux\r\nOS-release            : 5.15.0-1066-azure\r\nVersion               : # 75-Ubuntu SMP Thu May 30 14:29:45 UTC 2024\r\nmachine               : x86_64\r\nprocessor             : x86_64\r\nbyteorder             : little\r\nLC_ALL                : en_US.UTF-8\r\nLANG                  : en_US.UTF-8\r\nLOCALE                : en_US.UTF-8\r\n\r\npandas                : 3.0.0.dev0+1413.ge4956ab403\r\nnumpy                 : 2.0.2\r\ndateutil              : 2.9.0\r\npip                   : 24.2\r\nCython                : None\r\nsphinx                : None\r\nIPython               : 8.26.0\r\nadbc-driver-postgresql: None\r\nadbc-driver-sqlite    : None\r\nbs4                   : None\r\nblosc                 : None\r\nbottleneck            : None\r\nfastparquet           : None\r\nfsspec                : None\r\nhtml5lib              : None\r\nhypothesis            : None\r\ngcsfs                 : None\r\njinja2                : None\r\nlxml.etree            : None\r\nmatplotlib            : None\r\nnumba                 : 0.60.0\r\nnumexpr               : None\r\nodfpy                 : None\r\nopenpyxl              : None\r\npsycopg2              : None\r\npymysql               : None\r\npyarrow               : None\r\npyreadstat            : None\r\npytest                : None\r\npython-calamine       : None\r\npytz                  : 2024.1\r\npyxlsb                : None\r\ns3fs                  : None\r\nscipy                 : None\r\nsqlalchemy            : None\r\ntables                : None\r\ntabulate              : None\r\nxarray                : None\r\nxlrd                  : None\r\nxlsxwriter            : None\r\nzstandard             : None\r\ntzdata                : 2024.1\r\nqtpy                  : None\r\npyqt5                 : None\r\n\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59666/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59666/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59664", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59664/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59664/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59664/events", "html_url": "https://github.com/pandas-dev/pandas/issues/59664", "id": 2497035795, "node_id": "I_kwDOAA0YD86U1b4T", "number": 59664, "title": "RLS: 2.3", "user": {"login": "lithomas1", "id": 47963215, "node_id": "MDQ6VXNlcjQ3OTYzMjE1", "avatar_url": "https://avatars.githubusercontent.com/u/47963215?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lithomas1", "html_url": "https://github.com/lithomas1", "followers_url": "https://api.github.com/users/lithomas1/followers", "following_url": "https://api.github.com/users/lithomas1/following{/other_user}", "gists_url": "https://api.github.com/users/lithomas1/gists{/gist_id}", "starred_url": "https://api.github.com/users/lithomas1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lithomas1/subscriptions", "organizations_url": "https://api.github.com/users/lithomas1/orgs", "repos_url": "https://api.github.com/users/lithomas1/repos", "events_url": "https://api.github.com/users/lithomas1/events{/privacy}", "received_events_url": "https://api.github.com/users/lithomas1/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 131473665, "node_id": "MDU6TGFiZWwxMzE0NzM2NjU=", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Release", "name": "Release", "color": "006b75", "default": false, "description": null}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pandas-dev/pandas/milestones/119", "html_url": "https://github.com/pandas-dev/pandas/milestone/119", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/milestones/119/labels", "id": 11466880, "node_id": "MI_kwDOAA0YD84ArviA", "number": 119, "title": "2.3", "description": "", "creator": {"login": "jorisvandenbossche", "id": 1020496, "node_id": "MDQ6VXNlcjEwMjA0OTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1020496?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jorisvandenbossche", "html_url": "https://github.com/jorisvandenbossche", "followers_url": "https://api.github.com/users/jorisvandenbossche/followers", "following_url": "https://api.github.com/users/jorisvandenbossche/following{/other_user}", "gists_url": "https://api.github.com/users/jorisvandenbossche/gists{/gist_id}", "starred_url": "https://api.github.com/users/jorisvandenbossche/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jorisvandenbossche/subscriptions", "organizations_url": "https://api.github.com/users/jorisvandenbossche/orgs", "repos_url": "https://api.github.com/users/jorisvandenbossche/repos", "events_url": "https://api.github.com/users/jorisvandenbossche/events{/privacy}", "received_events_url": "https://api.github.com/users/jorisvandenbossche/received_events", "type": "User", "site_admin": false}, "open_issues": 11, "closed_issues": 39, "state": "open", "created_at": "2024-08-20T19:39:44Z", "updated_at": "2024-09-02T12:03:43Z", "due_on": null, "closed_at": null}, "comments": 2, "created_at": "2024-08-30T12:00:31Z", "updated_at": "2024-08-31T01:24:01Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "Release Date: ???\r\n\r\nFeatures:\r\n\r\n- [ ] Non-breaking PDEP-14 implementation https://github.com/pandas-dev/pandas/pull/58551\r\n- [ ] Publish Python 3.13 wheels\r\n- [ ] Numpy 2.1 compatibility (may also require dropping Python 3.9)\r\n\r\ncc @pandas-dev/pandas-core\r\n\r\n", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59664/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59664/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59659", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59659/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59659/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59659/events", "html_url": "https://github.com/pandas-dev/pandas/issues/59659", "id": 2496553230, "node_id": "I_kwDOAA0YD86UzmEO", "number": 59659, "title": "ENH: increase verbosity on error", "user": {"login": "romeokienzler", "id": 5694071, "node_id": "MDQ6VXNlcjU2OTQwNzE=", "avatar_url": "https://avatars.githubusercontent.com/u/5694071?v=4", "gravatar_id": "", "url": "https://api.github.com/users/romeokienzler", "html_url": "https://github.com/romeokienzler", "followers_url": "https://api.github.com/users/romeokienzler/followers", "following_url": "https://api.github.com/users/romeokienzler/following{/other_user}", "gists_url": "https://api.github.com/users/romeokienzler/gists{/gist_id}", "starred_url": "https://api.github.com/users/romeokienzler/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/romeokienzler/subscriptions", "organizations_url": "https://api.github.com/users/romeokienzler/orgs", "repos_url": "https://api.github.com/users/romeokienzler/repos", "events_url": "https://api.github.com/users/romeokienzler/events{/privacy}", "received_events_url": "https://api.github.com/users/romeokienzler/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 76812, "node_id": "MDU6TGFiZWw3NjgxMg==", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Enhancement", "name": "Enhancement", "color": "4E9A06", "default": false, "description": null}, {"id": 1954720290, "node_id": "MDU6TGFiZWwxOTU0NzIwMjkw", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage", "name": "Needs Triage", "color": "0052cc", "default": false, "description": "Issue that has not been reviewed by a pandas team member"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2024-08-30T08:16:31Z", "updated_at": "2024-08-30T08:16:31Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Feature Type\n\n- [ ] Adding new functionality to pandas\n\n- [X] Changing existing functionality in pandas\n\n- [ ] Removing existing functionality in pandas\n\n\n### Problem Description\n\nOn a specific type error the error causing type is not logged in the error\n\n### Feature Description\n\nBy replacing:\r\n`raise AttributeError(\"Can only use .str accessor with string values!\")`\r\nwith\r\n`raise AttributeError(f\"Can only use .str accessor with string values! Inferred dType: {inferred_dtype}\")`\r\nthe problem would be solved\r\n\r\nDetails can be found in [here](https://github.com/pandas-dev/pandas/pull/59649/files)\n\n### Alternative Solutions\n\nUse a debugger and set a break point\n\n### Additional Context\n\n_No response_", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59659/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59659/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59657", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59657/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59657/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59657/events", "html_url": "https://github.com/pandas-dev/pandas/issues/59657", "id": 2496456912, "node_id": "I_kwDOAA0YD86UzOjQ", "number": 59657, "title": "PERF: Melt 2x slower when future.infer_string option enabled", "user": {"login": "maver1ck", "id": 4006010, "node_id": "MDQ6VXNlcjQwMDYwMTA=", "avatar_url": "https://avatars.githubusercontent.com/u/4006010?v=4", "gravatar_id": "", "url": "https://api.github.com/users/maver1ck", "html_url": "https://github.com/maver1ck", "followers_url": "https://api.github.com/users/maver1ck/followers", "following_url": "https://api.github.com/users/maver1ck/following{/other_user}", "gists_url": "https://api.github.com/users/maver1ck/gists{/gist_id}", "starred_url": "https://api.github.com/users/maver1ck/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/maver1ck/subscriptions", "organizations_url": "https://api.github.com/users/maver1ck/orgs", "repos_url": "https://api.github.com/users/maver1ck/repos", "events_url": "https://api.github.com/users/maver1ck/events{/privacy}", "received_events_url": "https://api.github.com/users/maver1ck/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 8935311, "node_id": "MDU6TGFiZWw4OTM1MzEx", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Performance", "name": "Performance", "color": "a10c02", "default": false, "description": "Memory or execution speed performance"}, {"id": 1954720290, "node_id": "MDU6TGFiZWwxOTU0NzIwMjkw", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage", "name": "Needs Triage", "color": "0052cc", "default": false, "description": "Issue that has not been reviewed by a pandas team member"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2024-08-30T07:27:56Z", "updated_at": "2024-08-30T07:29:22Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Pandas version checks\n\n- [X] I have checked that this issue has not already been reported.\n\n- [X] I have confirmed this issue exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.\n\n- [X] I have confirmed this issue exists on the main branch of pandas.\n\n\n### Reproducible Example\n\n```\r\nimport pandas as pd\r\nimport numpy as np\r\n\r\n# This configuration option makes this code slow\r\npd.options.future.infer_string = True\r\n\r\n# Define dimensions\r\nn_rows = 10000\r\nn_cols = 10000\r\n\r\n# Generate random IDs for the rows\r\nids = [f\"string_id_{i}\" for i in range(1, n_rows + 1)]\r\n\r\n# Generate a random sparse matrix with 10% non-NaN values\r\ndata = np.random.choice([np.nan, 1], size=(n_rows, n_cols), p=[0.9, 0.1])\r\n\r\n# Create a DataFrame from the sparse matrix and add the 'Id' column\r\ndf = pd.DataFrame(data, columns=[f\"column_name_{i}\" for i in range(1, n_cols + 1)])\r\ndf.insert(0, 'Id', ids)\r\n\r\n# Melt the DataFrame\r\ndf_melted = df.melt(id_vars=['Id'], var_name='Column', value_name='Value')\r\n\r\n# Display the first few rows of the melted DataFrame\r\ndf_melted.head()\r\n```\n\n### Installed Versions\n\n```\r\nINSTALLED VERSIONS\r\n------------------\r\ncommit                : d9cdd2ee5a58015ef6f4d15c7226110c9aab8140\r\npython                : 3.12.5.final.0\r\npython-bits           : 64\r\nOS                    : Darwin\r\nOS-release            : 23.6.0\r\nVersion               : Darwin Kernel Version 23.6.0: Mon Jul 29 21:14:30 PDT 2024; root:xnu-10063.141.2~1/RELEASE_ARM64_T6000\r\nmachine               : arm64\r\nprocessor             : arm\r\nbyteorder             : little\r\nLC_ALL                : None\r\nLANG                  : pl_PL.UTF-8\r\nLOCALE                : pl_PL.UTF-8\r\n\r\npandas                : 2.2.2\r\nnumpy                 : 2.1.0\r\npytz                  : 2024.1\r\ndateutil              : 2.9.0.post0\r\nsetuptools            : 73.0.1\r\npip                   : 24.1.2\r\nCython                : None\r\npytest                : 8.3.2\r\nhypothesis            : None\r\nsphinx                : None\r\nblosc                 : None\r\nfeather               : None\r\nxlsxwriter            : None\r\nlxml.etree            : None\r\nhtml5lib              : None\r\npymysql               : None\r\npsycopg2              : None\r\njinja2                : 3.1.4\r\nIPython               : 8.26.0\r\npandas_datareader     : None\r\nadbc-driver-postgresql: None\r\nadbc-driver-sqlite    : None\r\nbs4                   : 4.12.3\r\nbottleneck            : None\r\ndataframe-api-compat  : None\r\nfastparquet           : None\r\nfsspec                : 2024.6.1\r\ngcsfs                 : None\r\nmatplotlib            : None\r\nnumba                 : None\r\nnumexpr               : None\r\nodfpy                 : None\r\nopenpyxl              : None\r\npandas_gbq            : None\r\npyarrow               : 17.0.0\r\npyreadstat            : None\r\npython-calamine       : None\r\npyxlsb                : None\r\ns3fs                  : 2024.6.1\r\nscipy                 : None\r\nsqlalchemy            : None\r\ntables                : None\r\ntabulate              : None\r\nxarray                : None\r\nxlrd                  : None\r\nzstandard             : None\r\ntzdata                : 2024.1\r\nqtpy                  : None\r\npyqt5                 : None\r\n```\r\n\n\n### Prior Performance\n\nThis code with `pd.options.future.infer_string = False` runs in:\r\n`5.23 s \u00b1 1.35 s per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)`\r\nMemory consumption is around 14 GB.\r\n\r\nEnabling `pd.options.future.infer_string = True` makes it 2 times slower:\r\n`10.6 s \u00b1 40.9 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)`\r\nAlso memory consumption is bigger with peak around 25GB.", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59657/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59657/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59656", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59656/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59656/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59656/events", "html_url": "https://github.com/pandas-dev/pandas/issues/59656", "id": 2495918748, "node_id": "I_kwDOAA0YD86UxLKc", "number": 59656, "title": "BUG: arithmetic between datetime.timedelta scalar and series produces timedelta64[us] instead of timedelta64[ns]", "user": {"login": "sfc-gh-mvashishtha", "id": 149194323, "node_id": "U_kgDOCOSGUw", "avatar_url": "https://avatars.githubusercontent.com/u/149194323?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sfc-gh-mvashishtha", "html_url": "https://github.com/sfc-gh-mvashishtha", "followers_url": "https://api.github.com/users/sfc-gh-mvashishtha/followers", "following_url": "https://api.github.com/users/sfc-gh-mvashishtha/following{/other_user}", "gists_url": "https://api.github.com/users/sfc-gh-mvashishtha/gists{/gist_id}", "starred_url": "https://api.github.com/users/sfc-gh-mvashishtha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sfc-gh-mvashishtha/subscriptions", "organizations_url": "https://api.github.com/users/sfc-gh-mvashishtha/orgs", "repos_url": "https://api.github.com/users/sfc-gh-mvashishtha/repos", "events_url": "https://api.github.com/users/sfc-gh-mvashishtha/events{/privacy}", "received_events_url": "https://api.github.com/users/sfc-gh-mvashishtha/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 76811, "node_id": "MDU6TGFiZWw3NjgxMQ==", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Bug", "name": "Bug", "color": "e10c02", "default": false, "description": null}, {"id": 1954720290, "node_id": "MDU6TGFiZWwxOTU0NzIwMjkw", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage", "name": "Needs Triage", "color": "0052cc", "default": false, "description": "Issue that has not been reviewed by a pandas team member"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2024-08-30T01:02:35Z", "updated_at": "2024-08-30T01:02:35Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Pandas version checks\n\n- [X] I have checked that this issue has not already been reported.\n\n- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.\n\n- [ ] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.\n\n\n### Reproducible Example\n\n```python\nimport pandas as pd\r\nimport datetime\r\nimport numpy as np\r\n\r\ndelta = datetime.timedelta(days=1)\r\n\r\n# this is true\r\nassert pd.Series(delta).dtype == np.dtype('timedelta64[ns]')\r\n\r\n# this fails\r\nactual_dtype = (delta * pd.Series(1)).dtype\r\nassert actual_dtype == np.dtype('timedelta64[ns]'), actual_dtype\n```\n\n\n### Issue Description\n\nConstructing a series out of a `datetime.timedelta` gives a timedelta with nanosecond resolution, but multiplying a `datetime.timedelta` by a numeric series gives microsecond resolution.\n\n### Expected Behavior\n\nThe resolution should be the same in both cases.\n\n### Installed Versions\n\n<details>\r\n\r\n```\r\nINSTALLED VERSIONS\r\n------------------\r\ncommit                : d9cdd2ee5a58015ef6f4d15c7226110c9aab8140\r\npython                : 3.9.18.final.0\r\npython-bits           : 64\r\nOS                    : Darwin\r\nOS-release            : 23.6.0\r\nVersion               : Darwin Kernel Version 23.6.0: Mon Jul 29 21:13:04 PDT 2024; root:xnu-10063.141.2~1/RELEASE_ARM64_T6020\r\nmachine               : arm64\r\nprocessor             : arm\r\nbyteorder             : little\r\nLC_ALL                : None\r\nLANG                  : en_US.UTF-8\r\nLOCALE                : en_US.UTF-8\r\n\r\npandas                : 2.2.2\r\nnumpy                 : 1.26.3\r\npytz                  : 2023.3.post1\r\ndateutil              : 2.8.2\r\nsetuptools            : 68.2.2\r\npip                   : 23.3.1\r\nCython                : None\r\npytest                : None\r\nhypothesis            : None\r\nsphinx                : None\r\nblosc                 : None\r\nfeather               : None\r\nxlsxwriter            : None\r\nlxml.etree            : None\r\nhtml5lib              : None\r\npymysql               : None\r\npsycopg2              : None\r\njinja2                : None\r\nIPython               : 8.18.1\r\npandas_datareader     : None\r\nadbc-driver-postgresql: None\r\nadbc-driver-sqlite    : None\r\nbs4                   : None\r\nbottleneck            : None\r\ndataframe-api-compat  : None\r\nfastparquet           : None\r\nfsspec                : None\r\ngcsfs                 : None\r\nmatplotlib            : None\r\nnumba                 : None\r\nnumexpr               : None\r\nodfpy                 : None\r\nopenpyxl              : None\r\npandas_gbq            : None\r\npyarrow               : None\r\npyreadstat            : None\r\npython-calamine       : None\r\npyxlsb                : None\r\ns3fs                  : None\r\nscipy                 : None\r\nsqlalchemy            : None\r\ntables                : None\r\ntabulate              : None\r\nxarray                : None\r\nxlrd                  : None\r\nzstandard             : None\r\ntzdata                : 2023.4\r\nqtpy                  : None\r\npyqt5                 : None\r\n```\r\n\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59656/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59656/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59655", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59655/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59655/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59655/events", "html_url": "https://github.com/pandas-dev/pandas/pull/59655", "id": 2495892680, "node_id": "PR_kwDOAA0YD85558sl", "number": 59655, "title": "DOCS: fix docstring validation error for pandas.Series", "user": {"login": "githubalexliu", "id": 16779378, "node_id": "MDQ6VXNlcjE2Nzc5Mzc4", "avatar_url": "https://avatars.githubusercontent.com/u/16779378?v=4", "gravatar_id": "", "url": "https://api.github.com/users/githubalexliu", "html_url": "https://github.com/githubalexliu", "followers_url": "https://api.github.com/users/githubalexliu/followers", "following_url": "https://api.github.com/users/githubalexliu/following{/other_user}", "gists_url": "https://api.github.com/users/githubalexliu/gists{/gist_id}", "starred_url": "https://api.github.com/users/githubalexliu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/githubalexliu/subscriptions", "organizations_url": "https://api.github.com/users/githubalexliu/orgs", "repos_url": "https://api.github.com/users/githubalexliu/repos", "events_url": "https://api.github.com/users/githubalexliu/events{/privacy}", "received_events_url": "https://api.github.com/users/githubalexliu/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2024-08-30T00:33:04Z", "updated_at": "2024-08-30T00:33:53Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/pandas-dev/pandas/pulls/59655", "html_url": "https://github.com/pandas-dev/pandas/pull/59655", "diff_url": "https://github.com/pandas-dev/pandas/pull/59655.diff", "patch_url": "https://github.com/pandas-dev/pandas/pull/59655.patch", "merged_at": null}, "body": "Partially addresses https://github.com/pandas-dev/pandas/issues/59592\r\n\r\nFixes\r\n```\r\n-i \"pandas.Series.dt.normalize PR01\" \\\r\n-i \"pandas.Series.dt.qyear GL08\" \\\r\n```", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59655/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59655/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59654", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59654/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59654/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59654/events", "html_url": "https://github.com/pandas-dev/pandas/pull/59654", "id": 2495707939, "node_id": "PR_kwDOAA0YD8555b2Q", "number": 59654, "title": "expose `to_pandas_kwargs` in `read_parquet` with pyarrow backend", "user": {"login": "kleinhenz", "id": 3384785, "node_id": "MDQ6VXNlcjMzODQ3ODU=", "avatar_url": "https://avatars.githubusercontent.com/u/3384785?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kleinhenz", "html_url": "https://github.com/kleinhenz", "followers_url": "https://api.github.com/users/kleinhenz/followers", "following_url": "https://api.github.com/users/kleinhenz/following{/other_user}", "gists_url": "https://api.github.com/users/kleinhenz/gists{/gist_id}", "starred_url": "https://api.github.com/users/kleinhenz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kleinhenz/subscriptions", "organizations_url": "https://api.github.com/users/kleinhenz/orgs", "repos_url": "https://api.github.com/users/kleinhenz/repos", "events_url": "https://api.github.com/users/kleinhenz/events{/privacy}", "received_events_url": "https://api.github.com/users/kleinhenz/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2024-08-29T22:45:58Z", "updated_at": "2024-08-30T23:22:18Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/pandas-dev/pandas/pulls/59654", "html_url": "https://github.com/pandas-dev/pandas/pull/59654", "diff_url": "https://github.com/pandas-dev/pandas/pull/59654.diff", "patch_url": "https://github.com/pandas-dev/pandas/pull/59654.patch", "merged_at": null}, "body": "- [x] closes #56842 \r\n- [x] [Tests added and passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#writing-tests) if fixing a bug or adding a new feature\r\n- [x] All [code checks passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#pre-commit).\r\n- [ ] Added [type annotations](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#type-hints) to new arguments/methods/functions.\r\n- [x] Added an entry in the latest `doc/source/whatsnew/vX.X.X.rst` file if fixing a bug or adding a new feature.\r\n", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59654/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59654/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59653", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59653/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59653/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59653/events", "html_url": "https://github.com/pandas-dev/pandas/issues/59653", "id": 2495671200, "node_id": "I_kwDOAA0YD86UwOug", "number": 59653, "title": "BUG: some cases of binary arithmetic between string and timedelta raise TypeError", "user": {"login": "sfc-gh-mvashishtha", "id": 149194323, "node_id": "U_kgDOCOSGUw", "avatar_url": "https://avatars.githubusercontent.com/u/149194323?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sfc-gh-mvashishtha", "html_url": "https://github.com/sfc-gh-mvashishtha", "followers_url": "https://api.github.com/users/sfc-gh-mvashishtha/followers", "following_url": "https://api.github.com/users/sfc-gh-mvashishtha/following{/other_user}", "gists_url": "https://api.github.com/users/sfc-gh-mvashishtha/gists{/gist_id}", "starred_url": "https://api.github.com/users/sfc-gh-mvashishtha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sfc-gh-mvashishtha/subscriptions", "organizations_url": "https://api.github.com/users/sfc-gh-mvashishtha/orgs", "repos_url": "https://api.github.com/users/sfc-gh-mvashishtha/repos", "events_url": "https://api.github.com/users/sfc-gh-mvashishtha/events{/privacy}", "received_events_url": "https://api.github.com/users/sfc-gh-mvashishtha/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 76811, "node_id": "MDU6TGFiZWw3NjgxMQ==", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Bug", "name": "Bug", "color": "e10c02", "default": false, "description": null}, {"id": 1954720290, "node_id": "MDU6TGFiZWwxOTU0NzIwMjkw", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage", "name": "Needs Triage", "color": "0052cc", "default": false, "description": "Issue that has not been reviewed by a pandas team member"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2024-08-29T22:14:39Z", "updated_at": "2024-08-30T19:20:01Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Pandas version checks\r\n\r\n- [X] I have checked that this issue has not already been reported.\r\n\r\n- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.\r\n\r\n- [ ] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.\r\n\r\n\r\n### Reproducible Example\r\n\r\n```python\r\nimport pandas as pd\r\n\r\npd.Series(pd.Timedelta(1)) + pd.Series(['1'])\r\n```\r\n\r\n\r\n### Issue Description\r\n\r\nThe example above should produce `pd.Series(pd.Timedelta(2))`, but it raises a `TypeError` instead.\r\n\r\nThere are some other cases that don't work either:\r\n- `pd.Series(['1']) + pd.Series(pd.Timedelta(1))`\r\n- ` pd.Timedelta(1) + pd.Series(['1'])`\r\n- `pd.Series(pd.Timedelta(1)) + '1'`\r\n- `'1' + pd.Series(pd.Timedelta(1))`\r\n- `pd.Timedelta(1) + pd.Series('1')`\r\n\r\nBut some cases that do:\r\n\r\n- `pd.DataFrame(['1']) + pd.DataFrame([pd.Timedelta(1)])`\r\n- `pd.DataFrame([pd.Timedelta(1)]) + pd.DataFrame(['1'])`\r\n- `pd.Series(['1']) + pd.Timedelta(1)`\r\n- `pd.Series('1') + pd.Timedelta(1)`\r\n\r\n### Expected Behavior\r\n\r\nGiven that the `Timedelta` itself seems to support arithmetic with scalar strings,  it seems that dataframes and series of timedelta should support arithmetic with strings or data structures containing strings.\r\n\r\n### Installed Versions\r\n\r\n<details>\r\n\r\n```\r\nINSTALLED VERSIONS\r\n------------------\r\ncommit                : d9cdd2ee5a58015ef6f4d15c7226110c9aab8140\r\npython                : 3.9.18.final.0\r\npython-bits           : 64\r\nOS                    : Darwin\r\nOS-release            : 23.6.0\r\nVersion               : Darwin Kernel Version 23.6.0: Mon Jul 29 21:13:04 PDT 2024; root:xnu-10063.141.2~1/RELEASE_ARM64_T6020\r\nmachine               : arm64\r\nprocessor             : arm\r\nbyteorder             : little\r\nLC_ALL                : None\r\nLANG                  : en_US.UTF-8\r\nLOCALE                : en_US.UTF-8\r\n\r\npandas                : 2.2.2\r\nnumpy                 : 1.26.3\r\npytz                  : 2023.3.post1\r\ndateutil              : 2.8.2\r\nsetuptools            : 68.2.2\r\npip                   : 23.3.1\r\nCython                : None\r\npytest                : None\r\nhypothesis            : None\r\nsphinx                : None\r\nblosc                 : None\r\nfeather               : None\r\nxlsxwriter            : None\r\nlxml.etree            : None\r\nhtml5lib              : None\r\npymysql               : None\r\npsycopg2              : None\r\njinja2                : None\r\nIPython               : 8.18.1\r\npandas_datareader     : None\r\nadbc-driver-postgresql: None\r\nadbc-driver-sqlite    : None\r\nbs4                   : None\r\nbottleneck            : None\r\ndataframe-api-compat  : None\r\nfastparquet           : None\r\nfsspec                : None\r\ngcsfs                 : None\r\nmatplotlib            : None\r\nnumba                 : None\r\nnumexpr               : None\r\nodfpy                 : None\r\nopenpyxl              : None\r\npandas_gbq            : None\r\npyarrow               : None\r\npyreadstat            : None\r\npython-calamine       : None\r\npyxlsb                : None\r\ns3fs                  : None\r\nscipy                 : None\r\nsqlalchemy            : None\r\ntables                : None\r\ntabulate              : None\r\nxarray                : None\r\nxlrd                  : None\r\nzstandard             : None\r\ntzdata                : 2023.4\r\nqtpy                  : None\r\npyqt5                 : None\r\n```\r\n\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59653/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59653/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59652", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59652/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59652/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59652/events", "html_url": "https://github.com/pandas-dev/pandas/issues/59652", "id": 2495363248, "node_id": "I_kwDOAA0YD86UvDiw", "number": 59652, "title": "BUG: Pearson correlation outside expected range -1 to 1", "user": {"login": "madrjor02-bh", "id": 135046019, "node_id": "U_kgDOCAyjgw", "avatar_url": "https://avatars.githubusercontent.com/u/135046019?v=4", "gravatar_id": "", "url": "https://api.github.com/users/madrjor02-bh", "html_url": "https://github.com/madrjor02-bh", "followers_url": "https://api.github.com/users/madrjor02-bh/followers", "following_url": "https://api.github.com/users/madrjor02-bh/following{/other_user}", "gists_url": "https://api.github.com/users/madrjor02-bh/gists{/gist_id}", "starred_url": "https://api.github.com/users/madrjor02-bh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/madrjor02-bh/subscriptions", "organizations_url": "https://api.github.com/users/madrjor02-bh/orgs", "repos_url": "https://api.github.com/users/madrjor02-bh/repos", "events_url": "https://api.github.com/users/madrjor02-bh/events{/privacy}", "received_events_url": "https://api.github.com/users/madrjor02-bh/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 76811, "node_id": "MDU6TGFiZWw3NjgxMQ==", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Bug", "name": "Bug", "color": "e10c02", "default": false, "description": null}, {"id": 1954720290, "node_id": "MDU6TGFiZWwxOTU0NzIwMjkw", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage", "name": "Needs Triage", "color": "0052cc", "default": false, "description": "Issue that has not been reviewed by a pandas team member"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2024-08-29T19:20:32Z", "updated_at": "2024-08-29T19:20:32Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Pandas version checks\n\n- [X] I have checked that this issue has not already been reported.\n\n- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.\n\n- [X] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.\n\n\n### Reproducible Example\n\n```python\nvalues = [{'col1': 30.0, 'col2': 116.80000305175781},\r\n {'col1': None, 'col2': None},\r\n {'col1': None, 'col2': None},\r\n {'col1': None, 'col2': None},\r\n {'col1': None, 'col2': None},\r\n {'col1': None, 'col2': None},\r\n {'col1': None, 'col2': None},\r\n {'col1': None, 'col2': None},\r\n {'col1': None, 'col2': None},\r\n {'col1': None, 'col2': None},\r\n {'col1': None, 'col2': None},\r\n {'col1': None, 'col2': None},\r\n {'col1': None, 'col2': None},\r\n {'col1': 30.100000381469727, 'col2': 116.8000030517578},\r\n {'col1': None, 'col2': None},\r\n {'col1': None, 'col2': None}]\r\n\r\ndata = pd.DataFrame(values)\r\ndata.corr(method='pearson')\n```\n\n\n### Issue Description\n\nIn the code snipped I'm trying to calculate the correlation between a pair of columns. However, when using pearson correlation method for this particular example, the outputted correlation is outside the -1 to 1 expected range. \n\n### Expected Behavior\n\nThe output of the pearson correlation method should be inside the -1 to 1 range. \n\n### Installed Versions\n\n<details>\r\n\r\nINSTALLED VERSIONS\r\n------------------\r\ncommit                : d9cdd2ee5a58015ef6f4d15c7226110c9aab8140\r\npython                : 3.9.19.final.0\r\npython-bits           : 64\r\nOS                    : Linux\r\nOS-release            : 5.10.223-211.872.amzn2.x86_64\r\nVersion               : #1 SMP Mon Jul 29 19:52:29 UTC 2024\r\nmachine               : x86_64\r\nprocessor             : x86_64\r\nbyteorder             : little\r\nLC_ALL                : C.UTF-8\r\nLANG                  : C.UTF-8\r\nLOCALE                : en_US.UTF-8\r\n\r\npandas                : 2.2.2\r\nnumpy                 : 1.26.4\r\npytz                  : 2024.1\r\ndateutil              : 2.9.0.post0\r\nsetuptools            : 69.5.1\r\npip                   : 24.0\r\nCython                : None\r\npytest                : None\r\nhypothesis            : None\r\nsphinx                : None\r\nblosc                 : None\r\nfeather               : None\r\nxlsxwriter            : None\r\nlxml.etree            : None\r\nhtml5lib              : None\r\npymysql               : None\r\npsycopg2              : None\r\njinja2                : 3.1.4\r\nIPython               : 8.18.1\r\npandas_datareader     : None\r\nadbc-driver-postgresql: None\r\nadbc-driver-sqlite    : None\r\nbs4                   : None\r\nbottleneck            : None\r\ndataframe-api-compat  : None\r\nfastparquet           : None\r\nfsspec                : None\r\ngcsfs                 : None\r\nmatplotlib            : 3.9.2\r\nnumba                 : None\r\nnumexpr               : None\r\nodfpy                 : None\r\nopenpyxl              : 3.1.5\r\npandas_gbq            : None\r\npyarrow               : 14.0.1\r\npyreadstat            : None\r\npython-calamine       : None\r\npyxlsb                : None\r\ns3fs                  : None\r\nscipy                 : 1.10.1\r\nsqlalchemy            : 2.0.31\r\ntables                : None\r\ntabulate              : None\r\nxarray                : None\r\nxlrd                  : None\r\nzstandard             : None\r\ntzdata                : 2024.1\r\nqtpy                  : None\r\npyqt5                 : None\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59652/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59652/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59650", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59650/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59650/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59650/events", "html_url": "https://github.com/pandas-dev/pandas/issues/59650", "id": 2494600347, "node_id": "I_kwDOAA0YD86UsJSb", "number": 59650, "title": "BUG: diff method incorrect on datetime64[s]", "user": {"login": "namiyousef", "id": 64047828, "node_id": "MDQ6VXNlcjY0MDQ3ODI4", "avatar_url": "https://avatars.githubusercontent.com/u/64047828?v=4", "gravatar_id": "", "url": "https://api.github.com/users/namiyousef", "html_url": "https://github.com/namiyousef", "followers_url": "https://api.github.com/users/namiyousef/followers", "following_url": "https://api.github.com/users/namiyousef/following{/other_user}", "gists_url": "https://api.github.com/users/namiyousef/gists{/gist_id}", "starred_url": "https://api.github.com/users/namiyousef/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/namiyousef/subscriptions", "organizations_url": "https://api.github.com/users/namiyousef/orgs", "repos_url": "https://api.github.com/users/namiyousef/repos", "events_url": "https://api.github.com/users/namiyousef/events{/privacy}", "received_events_url": "https://api.github.com/users/namiyousef/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 76811, "node_id": "MDU6TGFiZWw3NjgxMQ==", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Bug", "name": "Bug", "color": "e10c02", "default": false, "description": null}, {"id": 1954720290, "node_id": "MDU6TGFiZWwxOTU0NzIwMjkw", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Needs%20Triage", "name": "Needs Triage", "color": "0052cc", "default": false, "description": "Issue that has not been reviewed by a pandas team member"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2024-08-29T14:15:49Z", "updated_at": "2024-08-29T18:31:31Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Pandas version checks\n\n- [X] I have checked that this issue has not already been reported.\n\n- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.\n\n- [X] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.\n\n\n### Reproducible Example\n\n```python\nimport pandas as pd\r\n\r\ndf = pd.DataFrame({\"date\": ['2022-01-01', '2023-01-01']}).astype({\"date\": \"datetime64[ns]\"})\r\nprint(df.date.diff())\r\n\r\n\r\ndf = pd.DataFrame({\"date\": ['2022-01-01', '2023-01-01']}).astype({\"date\": \"datetime64[s]\"})\r\nprint(df.date.diff())\n```\n\n\n### Issue Description\n\nI'm expecting the difference to be 365 days on both, however on the second example the difference ends up coming in nanoseconds as opposed to seconds.\n\n### Expected Behavior\n\nExpecting the diff to be 365 days on both\n\n### Installed Versions\n\n<details>\r\n\r\nReplace this line with the output of pd.show_versions()\r\n\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59650/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59650/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59649", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59649/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59649/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59649/events", "html_url": "https://github.com/pandas-dev/pandas/pull/59649", "id": 2493904579, "node_id": "PR_kwDOAA0YD855zeVX", "number": 59649, "title": "increase verbosity", "user": {"login": "romeokienzler", "id": 5694071, "node_id": "MDQ6VXNlcjU2OTQwNzE=", "avatar_url": "https://avatars.githubusercontent.com/u/5694071?v=4", "gravatar_id": "", "url": "https://api.github.com/users/romeokienzler", "html_url": "https://github.com/romeokienzler", "followers_url": "https://api.github.com/users/romeokienzler/followers", "following_url": "https://api.github.com/users/romeokienzler/following{/other_user}", "gists_url": "https://api.github.com/users/romeokienzler/gists{/gist_id}", "starred_url": "https://api.github.com/users/romeokienzler/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/romeokienzler/subscriptions", "organizations_url": "https://api.github.com/users/romeokienzler/orgs", "repos_url": "https://api.github.com/users/romeokienzler/repos", "events_url": "https://api.github.com/users/romeokienzler/events{/privacy}", "received_events_url": "https://api.github.com/users/romeokienzler/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 42670965, "node_id": "MDU6TGFiZWw0MjY3MDk2NQ==", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Error%20Reporting", "name": "Error Reporting", "color": "ffa0ff", "default": false, "description": "Incorrect or improved errors from pandas"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2024-08-29T09:20:27Z", "updated_at": "2024-08-30T18:11:45Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/pandas-dev/pandas/pulls/59649", "html_url": "https://github.com/pandas-dev/pandas/pull/59649", "diff_url": "https://github.com/pandas-dev/pandas/pull/59649.diff", "patch_url": "https://github.com/pandas-dev/pandas/pull/59649.patch", "merged_at": null}, "body": "increase verbosity of error message by including the type causing the error in the error message\r\n\r\n- [ ] closes #59659\r\n- [x] [Tests added and passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#writing-tests) if fixing a bug or adding a new feature\r\n- [x] All [code checks passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#pre-commit).\r\n- [ ] Added [type annotations](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#type-hints) to new arguments/methods/functions. -> not applicable\r\n- [ ] Added an entry in the latest `doc/source/whatsnew/vX.X.X.rst` file if fixing a bug or adding a new feature. -> minor change\r\n", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59649/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59649/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59647", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59647/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59647/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59647/events", "html_url": "https://github.com/pandas-dev/pandas/pull/59647", "id": 2492964348, "node_id": "PR_kwDOAA0YD855wWmN", "number": 59647, "title": "PERF: CategoricalDtype.update_dtype", "user": {"login": "mroeschke", "id": 10647082, "node_id": "MDQ6VXNlcjEwNjQ3MDgy", "avatar_url": "https://avatars.githubusercontent.com/u/10647082?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mroeschke", "html_url": "https://github.com/mroeschke", "followers_url": "https://api.github.com/users/mroeschke/followers", "following_url": "https://api.github.com/users/mroeschke/following{/other_user}", "gists_url": "https://api.github.com/users/mroeschke/gists{/gist_id}", "starred_url": "https://api.github.com/users/mroeschke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mroeschke/subscriptions", "organizations_url": "https://api.github.com/users/mroeschke/orgs", "repos_url": "https://api.github.com/users/mroeschke/repos", "events_url": "https://api.github.com/users/mroeschke/events{/privacy}", "received_events_url": "https://api.github.com/users/mroeschke/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 8935311, "node_id": "MDU6TGFiZWw4OTM1MzEx", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Performance", "name": "Performance", "color": "a10c02", "default": false, "description": "Memory or execution speed performance"}, {"id": 78527356, "node_id": "MDU6TGFiZWw3ODUyNzM1Ng==", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Categorical", "name": "Categorical", "color": "e11d21", "default": false, "description": "Categorical Data Type"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pandas-dev/pandas/milestones/102", "html_url": "https://github.com/pandas-dev/pandas/milestone/102", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/milestones/102/labels", "id": 9021906, "node_id": "MI_kwDOAA0YD84AianS", "number": 102, "title": "3.0", "description": "", "creator": {"login": "jbrockmendel", "id": 8078968, "node_id": "MDQ6VXNlcjgwNzg5Njg=", "avatar_url": "https://avatars.githubusercontent.com/u/8078968?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jbrockmendel", "html_url": "https://github.com/jbrockmendel", "followers_url": "https://api.github.com/users/jbrockmendel/followers", "following_url": "https://api.github.com/users/jbrockmendel/following{/other_user}", "gists_url": "https://api.github.com/users/jbrockmendel/gists{/gist_id}", "starred_url": "https://api.github.com/users/jbrockmendel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jbrockmendel/subscriptions", "organizations_url": "https://api.github.com/users/jbrockmendel/orgs", "repos_url": "https://api.github.com/users/jbrockmendel/repos", "events_url": "https://api.github.com/users/jbrockmendel/events{/privacy}", "received_events_url": "https://api.github.com/users/jbrockmendel/received_events", "type": "User", "site_admin": false}, "open_issues": 46, "closed_issues": 1215, "state": "open", "created_at": "2023-02-08T18:16:49Z", "updated_at": "2024-09-02T12:50:51Z", "due_on": null, "closed_at": null}, "comments": 1, "created_at": "2024-08-28T20:47:52Z", "updated_at": "2024-08-30T18:16:31Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/pandas-dev/pandas/pulls/59647", "html_url": "https://github.com/pandas-dev/pandas/pull/59647", "diff_url": "https://github.com/pandas-dev/pandas/pull/59647.diff", "patch_url": "https://github.com/pandas-dev/pandas/pull/59647.patch", "merged_at": null}, "body": "If a `CategoricalDtype` is passed to `CategoricalDtype.update_dtype`, this API will attempt to unnecessarily re-validate the categories if it was not None.\r\n\r\n`CategoricalDtype.update_dtype` is called in constructors like `Categorical.__init__` and `Categorical._simple_new` where there is an attempt to update the passed dtype with `ordered=False` if it was `None`. A fully validated `CategoricalDtype` should just return itself if passed to `update_dtype`\r\n\r\n```python\r\nIn [1]: import pandas as pd\r\n\r\nIn [2]: cdtype = pd.CategoricalDtype(categories=list(range(100_000)), ordered=True)\r\n\r\nIn [3]: base_dtype = pd.CategoricalDtype(ordered=False)\r\n\r\nIn [4]: %timeit base_dtype.update_dtype(cdtype)\r\n2.5 \u03bcs \u00b1 11.5 ns per loop (mean \u00b1 std. dev. of 7 runs, 100,000 loops each)\r\n\r\nIn [4]: %timeit base_dtype.update_dtype(cdtype)\r\n865 ns \u00b1 2.26 ns per loop (mean \u00b1 std. dev. of 7 runs, 1,000,000 loops each)\r\n```", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59647/reactions", "total_count": 1, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 1, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59647/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59646", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59646/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59646/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59646/events", "html_url": "https://github.com/pandas-dev/pandas/pull/59646", "id": 2492876419, "node_id": "PR_kwDOAA0YD855wDZZ", "number": 59646, "title": "BUG: Retain index when merging on an index", "user": {"login": "rob-sil", "id": 124158982, "node_id": "U_kgDOB2aEBg", "avatar_url": "https://avatars.githubusercontent.com/u/124158982?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rob-sil", "html_url": "https://github.com/rob-sil", "followers_url": "https://api.github.com/users/rob-sil/followers", "following_url": "https://api.github.com/users/rob-sil/following{/other_user}", "gists_url": "https://api.github.com/users/rob-sil/gists{/gist_id}", "starred_url": "https://api.github.com/users/rob-sil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rob-sil/subscriptions", "organizations_url": "https://api.github.com/users/rob-sil/orgs", "repos_url": "https://api.github.com/users/rob-sil/repos", "events_url": "https://api.github.com/users/rob-sil/events{/privacy}", "received_events_url": "https://api.github.com/users/rob-sil/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2024-08-28T19:51:55Z", "updated_at": "2024-08-28T20:48:19Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/pandas-dev/pandas/pulls/59646", "html_url": "https://github.com/pandas-dev/pandas/pull/59646", "diff_url": "https://github.com/pandas-dev/pandas/pull/59646.diff", "patch_url": "https://github.com/pandas-dev/pandas/pull/59646.patch", "merged_at": null}, "body": "- [x] closes #57291\r\n- [x] [Tests added and passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#writing-tests) if fixing a bug or adding a new feature\r\n- [x] All [code checks passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#pre-commit).\r\n- [x] Added [type annotations](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#type-hints) to new arguments/methods/functions.\r\n- [x] Added an entry in the latest `doc/source/whatsnew/v3.0.0.rst` file if fixing a bug or adding a new feature.\r\n\r\nSince `join` uses a `merge` internally, changing the index returned by `merge` would cause problems for `join`. To prevent this, I introduced a new argument that would control which index is returned by a merge operation. I also separated out the logic that determined what index to use from the code that created the indexers. Not sure this was the best way to fix this; apologies if I bit off more than I could chew.", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59646/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59646/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59636", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59636/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59636/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59636/events", "html_url": "https://github.com/pandas-dev/pandas/pull/59636", "id": 2490571220, "node_id": "PR_kwDOAA0YD855osCg", "number": 59636, "title": "Fix binary operations on attrs for Series and DataFrame", "user": {"login": "fbourgey", "id": 10298716, "node_id": "MDQ6VXNlcjEwMjk4NzE2", "avatar_url": "https://avatars.githubusercontent.com/u/10298716?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fbourgey", "html_url": "https://github.com/fbourgey", "followers_url": "https://api.github.com/users/fbourgey/followers", "following_url": "https://api.github.com/users/fbourgey/following{/other_user}", "gists_url": "https://api.github.com/users/fbourgey/gists{/gist_id}", "starred_url": "https://api.github.com/users/fbourgey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fbourgey/subscriptions", "organizations_url": "https://api.github.com/users/fbourgey/orgs", "repos_url": "https://api.github.com/users/fbourgey/repos", "events_url": "https://api.github.com/users/fbourgey/events{/privacy}", "received_events_url": "https://api.github.com/users/fbourgey/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2024-08-28T00:10:49Z", "updated_at": "2024-08-28T00:10:49Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/pandas-dev/pandas/pulls/59636", "html_url": "https://github.com/pandas-dev/pandas/pull/59636", "diff_url": "https://github.com/pandas-dev/pandas/pull/59636.diff", "patch_url": "https://github.com/pandas-dev/pandas/pull/59636.patch", "merged_at": null}, "body": "- [ ] closes #51607\r\n- [Test](https://github.com/pandas-dev/pandas/blob/main/pandas/tests/series/test_api.py)\r\n- [Test](https://github.com/pandas-dev/pandas/blob/main/pandas/tests/frame/test_api.py)\r\n", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59636/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59636/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59631", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59631/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59631/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59631/events", "html_url": "https://github.com/pandas-dev/pandas/issues/59631", "id": 2490419272, "node_id": "I_kwDOAA0YD86UcMhI", "number": 59631, "title": "ENH: support the Arrow PyCapsule Interface for importing data", "user": {"login": "jorisvandenbossche", "id": 1020496, "node_id": "MDQ6VXNlcjEwMjA0OTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1020496?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jorisvandenbossche", "html_url": "https://github.com/jorisvandenbossche", "followers_url": "https://api.github.com/users/jorisvandenbossche/followers", "following_url": "https://api.github.com/users/jorisvandenbossche/following{/other_user}", "gists_url": "https://api.github.com/users/jorisvandenbossche/gists{/gist_id}", "starred_url": "https://api.github.com/users/jorisvandenbossche/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jorisvandenbossche/subscriptions", "organizations_url": "https://api.github.com/users/jorisvandenbossche/orgs", "repos_url": "https://api.github.com/users/jorisvandenbossche/repos", "events_url": "https://api.github.com/users/jorisvandenbossche/events{/privacy}", "received_events_url": "https://api.github.com/users/jorisvandenbossche/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 76812, "node_id": "MDU6TGFiZWw3NjgxMg==", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Enhancement", "name": "Enhancement", "color": "4E9A06", "default": false, "description": null}, {"id": 3303158446, "node_id": "MDU6TGFiZWwzMzAzMTU4NDQ2", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Arrow", "name": "Arrow", "color": "f9d0c4", "default": false, "description": "pyarrow functionality"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2024-08-27T21:37:33Z", "updated_at": "2024-08-28T17:26:02Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "We have https://github.com/pandas-dev/pandas/pull/56587 and https://github.com/pandas-dev/pandas/issues/59518 now for exporting pandas DataFrame and Series through the Arrow PyCapsule Interface (i.e. adding `__arrow_c_stream__` methods), but we don't yet have the import counterpart.\r\n\r\nFor importing, the [specification](https://arrow.apache.org/docs/dev/format/CDataInterface/PyCapsuleInterface.html#non-goals) doesn't provide any API guidelines on what this should look like, so we have a couple of options. The two main ones I can think of:\r\n\r\n- Add a dedicated `from_arrow()` method, which could be top level (`pd.from_arrow(..)`) or as class methods (`pd.DataFrame.from_arrow(..)`)\r\n- Support such objects directly in the main constructors (`pd.Dataframe(..)`)\r\n\r\nIn pandas itself, we do have a couple of `from_..` class methods (`from_dict`/`from_records`), but often for objects we also allow in the main constructor (at least for the dict case), but I think the main differentiator is that the specific class methods then have more specialized keyword arguments (and therefore allow a larger variety of input). \r\nSo based on that pattern, we could also do both: add a `DataFrame.from_arrow()` class method, and then also accept such objects in `pd.DataFrame()`, passing through to `from_arrow()` (which could have more custom options to control how the conversion from arrow to pandas exactly is done).\r\n\r\nLooking at polars, it seems they also have both, but I am not entirely sure about the connection between both. [`pl.from_arrow` ](https://docs.pola.rs/api/python/stable/reference/api/polars.from_arrow.html) already existed but might be more specific for pyarrow? And then https://github.com/pola-rs/polars/pull/17693 added it to the main `pl.DataFrame(..)` constructor (@kylebarron)\r\n\r\nFor geopandas, I added a `GeoDataFrame.from_arrow()` method.\r\n\r\n(to be clear, everything said above also applies to `Series()` / `Series.from_arrow()` etc)\r\n\r\n\r\ncc @MarcoGorelli @WillAyd ", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59631/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59631/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59629", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59629/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59629/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59629/events", "html_url": "https://github.com/pandas-dev/pandas/pull/59629", "id": 2490347152, "node_id": "PR_kwDOAA0YD855n_PJ", "number": 59629, "title": "BUG: Fix inconsistent pivot table subaggregation when index is None", "user": {"login": "matiaslindgren", "id": 11295697, "node_id": "MDQ6VXNlcjExMjk1Njk3", "avatar_url": "https://avatars.githubusercontent.com/u/11295697?v=4", "gravatar_id": "", "url": "https://api.github.com/users/matiaslindgren", "html_url": "https://github.com/matiaslindgren", "followers_url": "https://api.github.com/users/matiaslindgren/followers", "following_url": "https://api.github.com/users/matiaslindgren/following{/other_user}", "gists_url": "https://api.github.com/users/matiaslindgren/gists{/gist_id}", "starred_url": "https://api.github.com/users/matiaslindgren/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/matiaslindgren/subscriptions", "organizations_url": "https://api.github.com/users/matiaslindgren/orgs", "repos_url": "https://api.github.com/users/matiaslindgren/repos", "events_url": "https://api.github.com/users/matiaslindgren/events{/privacy}", "received_events_url": "https://api.github.com/users/matiaslindgren/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2024-08-27T21:04:13Z", "updated_at": "2024-08-28T17:12:34Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/pandas-dev/pandas/pulls/59629", "html_url": "https://github.com/pandas-dev/pandas/pull/59629", "diff_url": "https://github.com/pandas-dev/pandas/pull/59629.diff", "patch_url": "https://github.com/pandas-dev/pandas/pull/59629.patch", "merged_at": null}, "body": "- [x] closes #58722 (Replace xxxx with the GitHub issue number)\r\n- [x] [Tests added and passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#writing-tests) if fixing a bug or adding a new feature\r\n- [x] All [code checks passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#pre-commit).\r\n- [ ] Added [type annotations](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#type-hints) to new arguments/methods/functions.\r\n- [x] Added an entry in the latest `doc/source/whatsnew/vX.X.X.rst` file if fixing a bug or adding a new feature.\r\n", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59629/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59629/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59627", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59627/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59627/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59627/events", "html_url": "https://github.com/pandas-dev/pandas/issues/59627", "id": 2490308716, "node_id": "I_kwDOAA0YD86Ubxhs", "number": 59627, "title": "BUG(?): Allow setitem to category/sparse of the same underlying dtype? ", "user": {"login": "mroeschke", "id": 10647082, "node_id": "MDQ6VXNlcjEwNjQ3MDgy", "avatar_url": "https://avatars.githubusercontent.com/u/10647082?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mroeschke", "html_url": "https://github.com/mroeschke", "followers_url": "https://api.github.com/users/mroeschke/followers", "following_url": "https://api.github.com/users/mroeschke/following{/other_user}", "gists_url": "https://api.github.com/users/mroeschke/gists{/gist_id}", "starred_url": "https://api.github.com/users/mroeschke/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mroeschke/subscriptions", "organizations_url": "https://api.github.com/users/mroeschke/orgs", "repos_url": "https://api.github.com/users/mroeschke/repos", "events_url": "https://api.github.com/users/mroeschke/events{/privacy}", "received_events_url": "https://api.github.com/users/mroeschke/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 76811, "node_id": "MDU6TGFiZWw3NjgxMQ==", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Bug", "name": "Bug", "color": "e10c02", "default": false, "description": null}, {"id": 6217899606, "node_id": "LA_kwDOAA0YD88AAAABcp2eVg", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/PDEP6-related", "name": "PDEP6-related", "color": "9240E6", "default": false, "description": "related to PDEP6 (not upcasting during setitem-like Series operations)"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2024-08-27T20:44:31Z", "updated_at": "2024-08-28T22:29:51Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "body": "### Pandas version checks\r\n\r\n- [X] I have checked that this issue has not already been reported.\r\n\r\n- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.\r\n\r\n- [X] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.\r\n\r\n\r\n### Reproducible Example\r\n\r\n```python\r\nIn [7]: df = pd.DataFrame(range(2))\r\n\r\nIn [8]: df.iloc[:, 0] = df.iloc[:, 0].astype(\"category\")\r\n\r\nTypeError: Invalid value '0    0\r\n1    1\r\nName: 0, dtype: category\r\nCategories (2, int64): [0, 1]' for dtype 'int64'\r\n```\r\n\r\n\r\n### Issue Description\r\n\r\nIn the PDEP 6 discussions (https://github.com/pandas-dev/pandas/issues/39584 https://github.com/pandas-dev/pandas/pull/50424), I can't find any discussion really of whether setting values with a different \"representation\" (e.g. to `category` or `sparse`) of the dtype should be disallowed. Technically casting to e.g. `category`, `sparse`, `ArrowDtype` of the same underlying type  doesn't _upcast_, so should that be allowed?\r\n\r\ncc @MarcoGorelli \r\n\r\n### Expected Behavior\r\n\r\nSetitem with category/sparse/ArrowDtype that doesn't change the underlying type should be allowed\r\n\r\n### Installed Versions\r\n\r\n<details>\r\n\r\nReplace this line with the output of pd.show_versions()\r\n\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59627/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59627/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59624", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59624/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59624/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59624/events", "html_url": "https://github.com/pandas-dev/pandas/pull/59624", "id": 2489702276, "node_id": "PR_kwDOAA0YD855l5EO", "number": 59624, "title": "API (string): str.center with pyarrow-backed string dtype", "user": {"login": "jbrockmendel", "id": 8078968, "node_id": "MDQ6VXNlcjgwNzg5Njg=", "avatar_url": "https://avatars.githubusercontent.com/u/8078968?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jbrockmendel", "html_url": "https://github.com/jbrockmendel", "followers_url": "https://api.github.com/users/jbrockmendel/followers", "following_url": "https://api.github.com/users/jbrockmendel/following{/other_user}", "gists_url": "https://api.github.com/users/jbrockmendel/gists{/gist_id}", "starred_url": "https://api.github.com/users/jbrockmendel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jbrockmendel/subscriptions", "organizations_url": "https://api.github.com/users/jbrockmendel/orgs", "repos_url": "https://api.github.com/users/jbrockmendel/repos", "events_url": "https://api.github.com/users/jbrockmendel/events{/privacy}", "received_events_url": "https://api.github.com/users/jbrockmendel/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 57522093, "node_id": "MDU6TGFiZWw1NzUyMjA5Mw==", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Strings", "name": "Strings", "color": "5319e7", "default": false, "description": "String extension data type and string data"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/pandas-dev/pandas/milestones/119", "html_url": "https://github.com/pandas-dev/pandas/milestone/119", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/milestones/119/labels", "id": 11466880, "node_id": "MI_kwDOAA0YD84ArviA", "number": 119, "title": "2.3", "description": "", "creator": {"login": "jorisvandenbossche", "id": 1020496, "node_id": "MDQ6VXNlcjEwMjA0OTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1020496?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jorisvandenbossche", "html_url": "https://github.com/jorisvandenbossche", "followers_url": "https://api.github.com/users/jorisvandenbossche/followers", "following_url": "https://api.github.com/users/jorisvandenbossche/following{/other_user}", "gists_url": "https://api.github.com/users/jorisvandenbossche/gists{/gist_id}", "starred_url": "https://api.github.com/users/jorisvandenbossche/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jorisvandenbossche/subscriptions", "organizations_url": "https://api.github.com/users/jorisvandenbossche/orgs", "repos_url": "https://api.github.com/users/jorisvandenbossche/repos", "events_url": "https://api.github.com/users/jorisvandenbossche/events{/privacy}", "received_events_url": "https://api.github.com/users/jorisvandenbossche/received_events", "type": "User", "site_admin": false}, "open_issues": 11, "closed_issues": 39, "state": "open", "created_at": "2024-08-20T19:39:44Z", "updated_at": "2024-09-02T12:03:43Z", "due_on": null, "closed_at": null}, "comments": 2, "created_at": "2024-08-27T15:22:41Z", "updated_at": "2024-09-01T16:14:08Z", "closed_at": null, "author_association": "MEMBER", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/pandas-dev/pandas/pulls/59624", "html_url": "https://github.com/pandas-dev/pandas/pull/59624", "diff_url": "https://github.com/pandas-dev/pandas/pull/59624.diff", "patch_url": "https://github.com/pandas-dev/pandas/pull/59624.patch", "merged_at": null}, "body": "- [x] closes #54807 (Replace xxxx with the GitHub issue number)\r\n- [x] [Tests added and passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#writing-tests) if fixing a bug or adding a new feature\r\n- [ ] All [code checks passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#pre-commit).\r\n- [ ] Added [type annotations](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#type-hints) to new arguments/methods/functions.\r\n- [x] Added an entry in the latest `doc/source/whatsnew/vX.X.X.rst` file if fixing a bug or adding a new feature.\r\n\r\nTwo bad options for older-pyarrow: different behavior or object fallback.  I guessed that @mroeschke would prefer different behavior here, would be happy to be proved wrong.", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59624/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59624/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59623", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59623/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59623/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59623/events", "html_url": "https://github.com/pandas-dev/pandas/issues/59623", "id": 2489324875, "node_id": "I_kwDOAA0YD86UYBVL", "number": 59623, "title": "BUG: style.map() not compatible with CSS string \"url(data:...\"", "user": {"login": "invalidarg", "id": 15253234, "node_id": "MDQ6VXNlcjE1MjUzMjM0", "avatar_url": "https://avatars.githubusercontent.com/u/15253234?v=4", "gravatar_id": "", "url": "https://api.github.com/users/invalidarg", "html_url": "https://github.com/invalidarg", "followers_url": "https://api.github.com/users/invalidarg/followers", "following_url": "https://api.github.com/users/invalidarg/following{/other_user}", "gists_url": "https://api.github.com/users/invalidarg/gists{/gist_id}", "starred_url": "https://api.github.com/users/invalidarg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/invalidarg/subscriptions", "organizations_url": "https://api.github.com/users/invalidarg/orgs", "repos_url": "https://api.github.com/users/invalidarg/repos", "events_url": "https://api.github.com/users/invalidarg/events{/privacy}", "received_events_url": "https://api.github.com/users/invalidarg/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 76811, "node_id": "MDU6TGFiZWw3NjgxMQ==", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Bug", "name": "Bug", "color": "e10c02", "default": false, "description": null}, {"id": 1728592794, "node_id": "MDU6TGFiZWwxNzI4NTkyNzk0", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Styler", "name": "Styler", "color": "006b75", "default": false, "description": "conditional formatting using DataFrame.style"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2024-08-27T13:11:00Z", "updated_at": "2024-09-02T08:59:50Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "body": "### Pandas version checks\n\n- [X] I have checked that this issue has not already been reported.\n\n- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.\n\n- [x] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.\n\n\n### Reproducible Example\n\n```python\nimport pandas as pd\r\nprint(pd.__version__) # 2.2.2\r\n\r\n# Creating toy data\r\ndata = {\r\n    \"country\": [ \"Canada\",  \"Denmark\"],\r\n    \"number\": [ 200, 400]\r\n}\r\n\r\ndef flag_background(country):\r\n    if country == \"Denmark\":\r\n        return \"\"\"background-image: url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" id=\"flag-icons-dk\" viewBox=\"0 0 640 480\"><path fill=\"%23c8102e\" d=\"M0 0h640.1v480H0z\"/><path fill=\"%23fff\" d=\"M205.7 0h68.6v480h-68.6z\"/><path fill=\"%23fff\" d=\"M0 205.7h640.1v68.6H0z\"/></svg>');\"\"\"\r\n    elif country == \"Canada\":\r\n        return \"background-color: red\"\r\n        \r\n\r\ndf = pd.DataFrame(data)\r\nprint(\r\n    (\r\n    df\r\n    .style\r\n    .map(flag_background)\r\n    ).to_html()\r\n)\r\n\r\n### css in output is broken:\r\n# #T_b3ead_row1_col0 {\r\n#   background-image: url('data;\r\n# }\r\n\r\n\r\n#### But set_table_styles() works!\r\n\r\nprint(\r\n    df\r\n    .style\r\n    .set_table_styles([\r\n          {\r\n              'selector': '.col0', \r\n                'props': \r\n                    [('background-image', '''url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" id=\"flag-icons-dk\" viewBox=\"0 0 640 480\"><path fill=\"%23c8102e\" d=\"M0 0h640.1v480H0z\"/><path fill=\"%23fff\" d=\"M205.7 0h68.6v480h-68.6z\"/><path fill=\"%23fff\" d=\"M0 205.7h640.1v68.6H0z\"/></svg>')'''), ('background-size', 'contain'),('background-repeat', 'no-repeat'),('background-position', 'center')]\r\n         }\r\n    ])\r\n    .to_html()\r\n)\r\n\r\n### css in output is OK:\r\n# #T_106ed .col0 {\r\n#   background-image: url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" id=\"flag-icons-dk\" viewBox=\"0 0 640 480\"><path fill=\"%23c8102e\" d=\"M0 0h640.1v480H0z\"/><path fill=\"%23fff\" d=\"M205.7 0h68.6v480h-68.6z\"/><path fill=\"%23fff\" d=\"M0 205.7h640.1v68.6H0z\"/></svg>');\r\n#   background-size: contain;\r\n#   background-repeat: no-repeat;\r\n#   background-position: center;\r\n# }\n```\n\n\n### Issue Description\n\nI am tring to add SVG flags to each country but styler breaks css values with `url(data:...`\r\n\r\nThe CSS string returned by the function in `style.map` must be \r\n\r\n`property : value ; property2 : value ;`\r\n\r\nBut there is valid CSS that does not follow this pattern. \r\ne.g. this is valid CSS:\r\n` background-image: url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" id=\"flag-icons-dk\" viewBox=\"0 0 640 480\"><path fill=\"%23c8102e\" d=\"M0 0h640.1v480H0z\"/><path fill=\"%23fff\" d=\"M205.7 0h68.6v480h-68.6z\"/><path fill=\"%23fff\" d=\"M0 205.7h640.1v68.6H0z\"/></svg>');`\r\n\r\n\r\nThe problem is that pandas finds two consecutive colons `:` is will replace the second with semicolon `;` and then truncate. I.e. the resulting HTML will be\r\n\r\n`background-image: url('data;`\r\n\n\n### Expected Behavior\n\nLet me input any valid CSS string. Remove validation / truncation since it is not compatible with valid CSS strings. \n\n### Installed Versions\n\n<details>\r\n\r\n/databricks/python/lib/python3.10/site-packages/_distutils_hack/__init__.py:33: UserWarning: Setuptools is replacing distutils.\r\n  warnings.warn(\"Setuptools is replacing distutils.\")\r\n\r\nINSTALLED VERSIONS\r\n------------------\r\ncommit                : d9cdd2ee5a58015ef6f4d15c7226110c9aab8140\r\npython                : 3.10.12.final.0\r\npython-bits           : 64\r\nOS                    : Linux\r\nOS-release            : 5.15.0-1067-azure\r\nVersion               : #76~20.04.1-Ubuntu SMP Thu Jun 13 18:00:23 UTC 2024\r\nmachine               : x86_64\r\nprocessor             : x86_64\r\nbyteorder             : little\r\nLC_ALL                : None\r\nLANG                  : C.UTF-8\r\nLOCALE                : en_US.UTF-8\r\n\r\npandas                : 2.2.2\r\nnumpy                 : 1.23.5\r\npytz                  : 2022.7\r\ndateutil              : 2.8.2\r\nsetuptools            : 65.6.3\r\npip                   : 22.3.1\r\nCython                : 0.29.32\r\npytest                : None\r\nhypothesis            : None\r\nsphinx                : None\r\nblosc                 : None\r\nfeather               : None\r\nxlsxwriter            : None\r\nlxml.etree            : 4.9.1\r\nhtml5lib              : None\r\npymysql               : None\r\npsycopg2              : None\r\njinja2                : 3.1.2\r\nIPython               : 8.14.0\r\npandas_datareader     : None\r\nadbc-driver-postgresql: None\r\nadbc-driver-sqlite    : None\r\nbs4                   : None\r\nbottleneck            : None\r\ndataframe-api-compat  : None\r\nfastparquet           : None\r\nfsspec                : None\r\ngcsfs                 : None\r\nmatplotlib            : 3.7.0\r\nnumba                 : None\r\nnumexpr               : None\r\nodfpy                 : None\r\nopenpyxl              : None\r\npandas_gbq            : None\r\npyarrow               : None\r\npyreadstat            : None\r\npython-calamine       : None\r\npyxlsb                : None\r\ns3fs                  : None\r\nscipy                 : 1.10.0\r\nsqlalchemy            : None\r\ntables                : None\r\ntabulate              : None\r\nxarray                : None\r\nxlrd                  : None\r\nzstandard             : None\r\ntzdata                : 2024.1\r\nqtpy                  : None\r\npyqt5                 : None\r\n\r\n</details>\r\n", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59623/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59623/timeline", "performed_via_github_app": null, "state_reason": null}, {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59620", "repository_url": "https://api.github.com/repos/pandas-dev/pandas", "labels_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59620/labels{/name}", "comments_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59620/comments", "events_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59620/events", "html_url": "https://github.com/pandas-dev/pandas/pull/59620", "id": 2487671016, "node_id": "PR_kwDOAA0YD855e9I7", "number": 59620, "title": "BUG: Resampling to \"B\" frequency with closed=\"right\" and label=\"right\" adds empty bins", "user": {"login": "natmokval", "id": 91160475, "node_id": "MDQ6VXNlcjkxMTYwNDc1", "avatar_url": "https://avatars.githubusercontent.com/u/91160475?v=4", "gravatar_id": "", "url": "https://api.github.com/users/natmokval", "html_url": "https://github.com/natmokval", "followers_url": "https://api.github.com/users/natmokval/followers", "following_url": "https://api.github.com/users/natmokval/following{/other_user}", "gists_url": "https://api.github.com/users/natmokval/gists{/gist_id}", "starred_url": "https://api.github.com/users/natmokval/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/natmokval/subscriptions", "organizations_url": "https://api.github.com/users/natmokval/orgs", "repos_url": "https://api.github.com/users/natmokval/repos", "events_url": "https://api.github.com/users/natmokval/events{/privacy}", "received_events_url": "https://api.github.com/users/natmokval/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 76811, "node_id": "MDU6TGFiZWw3NjgxMQ==", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Bug", "name": "Bug", "color": "e10c02", "default": false, "description": null}, {"id": 74975453, "node_id": "MDU6TGFiZWw3NDk3NTQ1Mw==", "url": "https://api.github.com/repos/pandas-dev/pandas/labels/Resample", "name": "Resample", "color": "207de5", "default": false, "description": "resample method"}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2024-08-26T20:04:36Z", "updated_at": "2024-08-28T17:19:36Z", "closed_at": null, "author_association": "CONTRIBUTOR", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/pandas-dev/pandas/pulls/59620", "html_url": "https://github.com/pandas-dev/pandas/pull/59620", "diff_url": "https://github.com/pandas-dev/pandas/pull/59620.diff", "patch_url": "https://github.com/pandas-dev/pandas/pull/59620.patch", "merged_at": null}, "body": "- [x] closes #59495\r\n- [x] Tests added and passed\r\n- [x] All [code checks passed](https://pandas.pydata.org/pandas-docs/dev/development/contributing_codebase.html#pre-commit).\r\n- [x] Added an entry in the latest `doc/source/whatsnew/v3.0.0.rst`\r\n\r\n\r\n\r\nfixed bug: Resampling to frequency='B' with closed='right'a nd label='right'\r\n", "reactions": {"url": "https://api.github.com/repos/pandas-dev/pandas/issues/59620/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/pandas-dev/pandas/issues/59620/timeline", "performed_via_github_app": null, "state_reason": null}]